[{"name":"app.R","content":"library(shiny)\nlibrary(detect)\nlibrary(bSims)\n\nMAXDIS <- 10\nEXTENT <- 10\nDURATION <- 10\nTINT <- list(\n  \"0-3-5-10 min\"=c(3, 5, 10),\n  \"0-10 min\"=c(10),\n  \"0-1-2-3 min\"=c(1, 2, 3),\n  \"0-5-10 min\"=c(5, 10),\n  \"0-3 min\"=c(3),\n  \"0-1-2-3-4-5 min\"=c(1, 2, 3, 4, 5)\n)\nRINT <- list(\n  \"0-50-100-Inf m\"=c(0.5, 1, Inf),\n  \"0-Inf m\"=c(Inf),\n  \"0-50-Inf m\"=c(0.5, Inf),\n  \"0-50-100-150-Inf m\"=c(0.5, 1, 1.5, Inf),\n  \"0-50-100-150-200-Inf m\"=c(0.5, 1, 1.5, 2, Inf),\n  \"0-50-100 m\"=c(0.5, 1),\n  \"0-50 m\"=c(0.5),\n  \"0-50-100-150 m\"=c(0.5, 1, 1.5),\n  \"0-50-100-150-200 m\"=c(0.5, 1, 1.5, 2)\n)\n\nui <- navbarPage(\"bSims (HER)\",\n  tabPanel(\"Initialize\",\n    column(6,\n      plotOutput(outputId = \"plot_ini\")),\n    column(6,\n      actionButton(\"seed\", \"Change random seed\"),\n      sliderInput(\"road\", \"Road half width\", 0, EXTENT/2, 0, EXTENT/40),\n      sliderInput(\"edge\", \"Edge width\", 0, EXTENT/2, 0, EXTENT/40),\n      sliderInput(\"offset\",\n        \"Offset for road position\", -EXTENT/2, EXTENT/2, 0, EXTENT/20)\n    )\n  ),\n  tabPanel(\"Populate\",\n    column(6,\n      plotOutput(outputId = \"plot_pop\")\n    ),\n    column(6,\n      sliderInput(\"DH\", \"Density in habitat stratum\", 0, 20, 1, 0.1),\n      sliderInput(\"DE\", \"Density in edge stratum\", 0, 20, 1, 0.1),\n      sliderInput(\"DR\", \"Density in road stratum\", 0, 20, 1, 0.1),\n      radioButtons(\"spfun\", \"Spatial pattern\",\n        c(\"Random\"=\"random\", \"Regular\"=\"regular\",\n          \"Clustered\"=\"clustered\"))\n    )\n  ),\n  tabPanel(\"Animate\",\n    column(6,\n      plotOutput(outputId = \"plot_ani\")),\n    column(6,\n      sliderInput(\"phiH\", \"Vocal in habitat stratum\", 0, 10, 0.5, 0.1),\n      sliderInput(\"phiE\", \"Vocal in edge stratum\", 0, 10, 0.5, 0.1),\n      sliderInput(\"phiR\", \"Vocal in road stratum\", 0, 10, 0.5, 0.1),\n      sliderInput(\"phim\", \"Movement rate\", 0, 10, 1, 0.1),\n      sliderInput(\"SDm\", \"Movement SD\", 0, 1, 0, 0.05),\n      radioButtons(\"avoid\", \"Avoid\",\n        c(\"None\"=\"none\",\n          \"Road\"=\"R\",\n          \"Edge and road\"=\"ER\")),\n      checkboxInput(\"overlap\", \"Territory overlap allowed\", TRUE),\n      checkboxInput(\"show_tess\", \"Show tessellation\", FALSE),\n      checkboxInput(\"init_loc\", \"Initial location\", FALSE)\n    )\n  ),\n  tabPanel(\"Detect\",\n    column(6,\n      plotOutput(outputId = \"plot_det\")\n    ),\n    column(6,\n      sliderInput(\"tauH\", \"EDR in habitat stratum\", 0, MAXDIS, 1, MAXDIS/200),\n      sliderInput(\"tauE\", \"EDR in edge stratum\", 0, MAXDIS, 1, MAXDIS/200),\n      sliderInput(\"tauR\", \"EDR in road stratum\", 0, MAXDIS, 1, MAXDIS/200),\n      radioButtons(\"event\", \"Event type\",\n        c(\"Vocalization\"=\"vocal\",\n          \"Movement\"=\"move\",\n          \"Both\"=\"both\"))\n    )\n  ),\n  tabPanel(\"Transcribe\",\n    fluidRow(\n      column(6,\n        plotOutput(outputId = \"plot_tra\")\n      ),\n      column(6,\n        selectInput(\"tint\", \"Time intervals\", names(TINT)),\n        selectInput(\"rint\", \"Distance intervals\", names(RINT)),\n        sliderInput(\"derr\", \"Distance error\", 0, 1, 0, 0.1),\n        radioButtons(\"condition\", \"Condition\",\n          c(\"1st event\"=\"event1\",\n            \"1st detection\"=\"det1\",\n            \"All detections\"=\"alldet\")),\n        sliderInput(\"percept\", \"Percepted ratio\", 0, 2, 1, 0.05),\n        checkboxInput(\"oucount\", \"Over/under count\", FALSE)\n      )\n    ),\n    fluidRow(\n      column(6,\n        tableOutput(outputId = \"table_rem\")\n      ),\n      column(6,\n        plotOutput(outputId = \"plot_est\")\n      )\n    )\n  ),\n  tabPanel(\"Settings\",\n    tagList(\n      singleton(\n        tags$head(\n          tags$script(src = 'clipboard.min.js')\n        )\n      )\n    ),\n    column(12,\n      verbatimTextOutput(\"settings\"),\n      uiOutput(\"clip\")\n    )\n  ),\n  tabPanel(\"Documentation\",\n    column(12,\n      tags$iframe(src=\"https://psolymos.github.io/bSims/\",\n        height=600, width=\"100%\", frameBorder=0)\n    )\n  )\n)\n\nserver <- function(input, output) {\n  rv <- reactiveValues(seed=0)\n  observeEvent(input$seed, {\n    rv$seed <- rv$seed + 1\n  })\n  dis <- seq(0, MAXDIS, MAXDIS/200)\n  l <- reactive({\n    set.seed(rv$seed)\n    bsims_init(extent = EXTENT,\n      road = input$road,\n      edge = input$edge,\n      offset = input$offset)\n  })\n  xy_fun <- reactive({\n    switch(input$spfun,\n      \"random\"=function(d) rep(1, length(d)),\n      \"regular\"=function(d)\n        (1-exp(-d^2/1^2) + dlnorm(d, 2)/dlnorm(2,2)) / 2,\n      \"clustered\"=function(d)\n        exp(-d^2/1^2) + 0.5*(1-exp(-d^2/4^2))\n      )\n  })\n  a <- reactive({\n    margin <- switch(input$spfun,\n      \"random\"=0,\n      \"regular\"=2,\n      \"clustered\"=5)\n    bsims_populate(l(),\n      density = c(input$DH, input$DE, input$DR),\n      xy_fun = xy_fun(),\n      margin = margin)\n  })\n  b <- reactive({\n    if (input$avoid == \"R\" && input$DR > 0) {\n      showNotification(\"Only 0 abundance stratum can be avoided, set road density to 0\", type=\"error\")\n      return(NULL)\n    }\n    if (input$avoid == \"ER\" && (input$DE > 0 || input$DR > 0)) {\n      showNotification(\"Only 0 abundance stratum can be avoided, set road and edge densities to 0\", type=\"error\")\n      return(NULL)\n    }\n    bsims_animate(a(),\n      duration = DURATION,\n      vocal_rate = c(input$phiH, input$phiE, input$phiR),\n      move_rate = input$phim,\n      movement = input$SDm,\n      mixture = 1,\n      avoid = input$avoid,\n      allow_overlap = input$overlap,\n      initial_location = input$init_loc)\n  })\n  o <- reactive({\n    bsims_detect(b(),\n      xy = c(0, 0),\n      tau = c(input$tauH, input$tauE, input$tauR),\n      dist_fun = NULL,\n      #dist_fun = function(d, tau) { print(c(length(d), length(tau)));exp(-d^2/tau^2)},\n#      repel = input$repel,\n      event_type = input$event)\n  })\n  m <- reactive({\n    pr <- if (!input$oucount)\n      NULL else input$percept\n    bsims_transcribe(o(),\n      tint = TINT[[input$tint]],\n      rint = RINT[[input$rint]],\n      error = input$derr,\n      condition = input$condition,\n      event_type = input$event,\n      perception = pr\n    )\n  })\n  e <- reactive({\n    REM <- get_table(m())\n    MaxDur <- max(TINT[[input$tint]])\n    MaxDis <- max(RINT[[input$rint]])\n    Ydur <- matrix(colSums(REM), 1)\n    Ddur <- matrix(TINT[[input$tint]], 1)\n    Ydis <- matrix(rowSums(REM), 1)\n    Ddis <- matrix(RINT[[input$rint]], 1)\n    if (length(TINT[[input$tint]]) > 1 && sum(REM) > 0) {\n      Mrem <- try(cmulti.fit(Ydur, Ddur, type=\"rem\"))\n      if (!inherits(Mrem, \"try-error\")) {\n        phi <- exp(Mrem$coef)\n        p <- 1-exp(-MaxDur*phi)\n      } else {\n        Mrem <- NULL\n        phi <- NA\n        p <- NA\n      }\n    } else {\n      Mrem <- NULL\n      phi <- NA\n      p <- NA\n    }\n    if (length(RINT[[input$rint]]) > 1 && sum(REM) > 0) {\n      Mdis <- try(cmulti.fit(Ydis, Ddis, type=\"dis\"))\n      if (!inherits(Mdis, \"try-error\")) {\n        tau <- exp(Mdis$coef)\n        q <- if (is.infinite(MaxDis))\n          1 else (tau^2/MaxDis^2) * (1-exp(-(MaxDis/tau)^2))\n        A <- if (is.infinite(MaxDis))\n          pi * tau^2 else pi * MaxDis^2\n      } else {\n        Mdis <- NULL\n        tau <- NA\n        q <- NA\n        A <- NA\n      }\n    } else {\n      Mdis <- NULL\n      tau <- NA\n      q <- NA\n      A <- NA\n    }\n    D <- sum(REM) / (A * p * q)\n    list(\n      Ydur=Ydur, Ddur=Ddur,\n      Ydis=Ydis, Ddis=Ddis,\n      Mrem=Mrem,\n      Mdis=Mdis,\n      phi=phi, tau=tau,\n      A=A, p=p, q=q,\n      D=D)\n  })\n  getset <- reactive({\n    xc <- function(x) paste0(\"c(\", paste0(x, collapse=\", \"), \")\")\n    xq <- function(x) paste0(\"'\", x, \"'\", collapse=\"\")\n    margin <- switch(input$spfun,\n      \"random\"=0,\n      \"regular\"=2,\n      \"clustered\"=5)\n    pr <- if (!input$oucount)\n      \"NULL\" else input$percept\n    paste0(\"bsims_all(\",\n    \"\\n  extent = \", EXTENT,\n    \",\\n  road = \", input$road,\n    \",\\n  edge = \", input$edge,\n    \",\\n  offset = \", input$offset,\n    \",\\n  density = \", xc(c(input$DH, input$DE, input$DR)),\n    \",\\n  xy_fun = \", paste0(deparse(xy_fun()), collapse=''),\n    \",\\n  margin = \", margin,\n    \",\\n  duration = \", DURATION,\n    \",\\n  vocal_rate = \", xc(c(input$phiH, input$phiE, input$phiR)),\n    \",\\n  move_rate = \", input$phim,\n    \",\\n  movement = \", input$SDm,\n    \",\\n  mixture = 1\",\n    \",\\n  allow_overlap = \", input$overlap,\n    \",\\n  initial_location = \", input$init_loc,\n    \",\\n  tau = \", xc(c(input$tauH, input$tauE, input$tauR)),\n#    \",\\n  dist_fun = NULL\",\n    \",\\n  xy = c(0, 0)\",\n    \",\\n  event_type = \", xq(input$event),\n    \",\\n  tint = \", xc(TINT[[input$tint]]),\n    \",\\n  rint = \", xc(RINT[[input$rint]]),\n    \",\\n  error = \", input$derr,\n    \",\\n  condition = \", xq(input$condition),\n    \",\\n  perception = \", pr,\n    \")\", collapse=\"\")\n  })\n\n  output$plot_ini <- renderPlot({\n    op <- par(mar=c(0,0,0,0))\n    plot(l())\n    par(op)\n  })\n  output$plot_pop <- renderPlot({\n    req(a())\n    op <- par(mar=c(0,0,0,0))\n    plot(a())\n    par(op)\n  })\n  output$plot_ani <- renderPlot({\n    req(b())\n    op <- par(mar=c(0,0,0,0))\n    plot(b(), event_type=input$event)\n    if (input$show_tess && !is.null(b()$tess))\n      plot(b()$tess, add=TRUE, wlines=\"tess\",\n        showpoints=FALSE, cmpnt_col=\"grey\", cmpnt_lty=1)\n    par(op)\n  })\n  output$plot_det <- renderPlot({\n    req(o())\n    op <- par(mar=c(0,0,0,0))\n    plot(o(),\n      event_type=input$event,\n      condition=input$condition)\n    par(op)\n  })\n  output$plot_tra <- renderPlot({\n    req(m())\n    op <- par(mar=c(0,0,0,0))\n    plot(m())\n    par(op)\n  })\n  output$table_rem <- renderTable({\n    req(m())\n    tab <- get_table(m())\n    tab <- cbind(tab, Total=rowSums(tab))\n    tab <- rbind(tab, Total=colSums(tab))\n    tab\n  }, rownames = TRUE, colnames = TRUE, digits = 0)\n  output$plot_est <- renderPlot({\n    req(e())\n    v <- e()\n    col <- c(\"#ffe042\", \"#e71989\")\n    op <- par(mfrow=c(1,3))\n    barplot(c(True=input$phiH, Estimate=v$phi),\n      col=col, main=expression(phi))\n    barplot(c(True=input$tauH, Estimate=v$tau),\n      col=col, main=expression(tau))\n    barplot(c(True=input$DH, Estimate=v$D),\n      col=col, main=expression(D))\n    par(op)\n  })\n  output$settings <- renderText({\n    getset()\n  })\n  output$clip <- renderUI({\n    tagList(\n      actionButton(\"clipbtn\",\n        label = \"Copy settings to clipboard\",\n        icon = icon(\"clipboard\"),\n        `data-clipboard-text` = paste(\n          getset(),\n          collapse=\"\")\n      ),\n      tags$script(\n        'new ClipboardJS(\".btn\", document.getElementById(\"clipbtn\") );')\n    )\n  })\n}\n\nshinyApp(ui = ui, server = server)\n","type":"text"},{"name":"www/clipboard.min.js","content":"/*!\n * clipboard.js v2.0.4\n * https://zenorocha.github.io/clipboard.js\n * \n * Licensed MIT © Zeno Rocha\n */\n!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.ClipboardJS=e():t.ClipboardJS=e()}(this,function(){return function(n){var o={};function r(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=n,r.c=o,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,\"a\",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p=\"\",r(r.s=0)}([function(t,e,n){\"use strict\";var r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},i=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}(),a=o(n(1)),c=o(n(3)),u=o(n(4));function o(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function o(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,o);var n=function(t,e){if(!t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!e||\"object\"!=typeof e&&\"function\"!=typeof e?t:e}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return n.resolveOptions(e),n.listenClick(t),n}return function(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(o,c.default),i(o,[{key:\"resolveOptions\",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action=\"function\"==typeof t.action?t.action:this.defaultAction,this.target=\"function\"==typeof t.target?t.target:this.defaultTarget,this.text=\"function\"==typeof t.text?t.text:this.defaultText,this.container=\"object\"===r(t.container)?t.container:document.body}},{key:\"listenClick\",value:function(t){var e=this;this.listener=(0,u.default)(t,\"click\",function(t){return e.onClick(t)})}},{key:\"onClick\",value:function(t){var e=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new a.default({action:this.action(e),target:this.target(e),text:this.text(e),container:this.container,trigger:e,emitter:this})}},{key:\"defaultAction\",value:function(t){return s(\"action\",t)}},{key:\"defaultTarget\",value:function(t){var e=s(\"target\",t);if(e)return document.querySelector(e)}},{key:\"defaultText\",value:function(t){return s(\"text\",t)}},{key:\"destroy\",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:\"isSupported\",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[\"copy\",\"cut\"],e=\"string\"==typeof t?[t]:t,n=!!document.queryCommandSupported;return e.forEach(function(t){n=n&&!!document.queryCommandSupported(t)}),n}}]),o}();function s(t,e){var n=\"data-clipboard-\"+t;if(e.hasAttribute(n))return e.getAttribute(n)}t.exports=l},function(t,e,n){\"use strict\";var o,r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},i=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}(),a=n(2),c=(o=a)&&o.__esModule?o:{default:o};var u=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,e),this.resolveOptions(t),this.initSelection()}return i(e,[{key:\"resolveOptions\",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action=t.action,this.container=t.container,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=\"\"}},{key:\"initSelection\",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:\"selectFake\",value:function(){var t=this,e=\"rtl\"==document.documentElement.getAttribute(\"dir\");this.removeFake(),this.fakeHandlerCallback=function(){return t.removeFake()},this.fakeHandler=this.container.addEventListener(\"click\",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement(\"textarea\"),this.fakeElem.style.fontSize=\"12pt\",this.fakeElem.style.border=\"0\",this.fakeElem.style.padding=\"0\",this.fakeElem.style.margin=\"0\",this.fakeElem.style.position=\"absolute\",this.fakeElem.style[e?\"right\":\"left\"]=\"-9999px\";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+\"px\",this.fakeElem.setAttribute(\"readonly\",\"\"),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,c.default)(this.fakeElem),this.copyText()}},{key:\"removeFake\",value:function(){this.fakeHandler&&(this.container.removeEventListener(\"click\",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:\"selectTarget\",value:function(){this.selectedText=(0,c.default)(this.target),this.copyText()}},{key:\"copyText\",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:\"handleResult\",value:function(t){this.emitter.emit(t?\"success\":\"error\",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:\"clearSelection\",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:\"destroy\",value:function(){this.removeFake()}},{key:\"action\",set:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:\"copy\";if(this._action=t,\"copy\"!==this._action&&\"cut\"!==this._action)throw new Error('Invalid \"action\" value, use either \"copy\" or \"cut\"')},get:function(){return this._action}},{key:\"target\",set:function(t){if(void 0!==t){if(!t||\"object\"!==(void 0===t?\"undefined\":r(t))||1!==t.nodeType)throw new Error('Invalid \"target\" value, use a valid Element');if(\"copy\"===this.action&&t.hasAttribute(\"disabled\"))throw new Error('Invalid \"target\" attribute. Please use \"readonly\" instead of \"disabled\" attribute');if(\"cut\"===this.action&&(t.hasAttribute(\"readonly\")||t.hasAttribute(\"disabled\")))throw new Error('Invalid \"target\" attribute. You can\\'t cut text from elements with \"readonly\" or \"disabled\" attributes');this._target=t}},get:function(){return this._target}}]),e}();t.exports=u},function(t,e){t.exports=function(t){var e;if(\"SELECT\"===t.nodeName)t.focus(),e=t.value;else if(\"INPUT\"===t.nodeName||\"TEXTAREA\"===t.nodeName){var n=t.hasAttribute(\"readonly\");n||t.setAttribute(\"readonly\",\"\"),t.select(),t.setSelectionRange(0,t.value.length),n||t.removeAttribute(\"readonly\"),e=t.value}else{t.hasAttribute(\"contenteditable\")&&t.focus();var o=window.getSelection(),r=document.createRange();r.selectNodeContents(t),o.removeAllRanges(),o.addRange(r),e=o.toString()}return e}},function(t,e){function n(){}n.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var o=this;function r(){o.off(t,r),e.apply(n,arguments)}return r._=e,this.on(t,r,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,r=n.length;o<r;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],r=[];if(o&&e)for(var i=0,a=o.length;i<a;i++)o[i].fn!==e&&o[i].fn._!==e&&r.push(o[i]);return r.length?n[t]=r:delete n[t],this}},t.exports=n},function(t,e,n){var d=n(5),h=n(6);t.exports=function(t,e,n){if(!t&&!e&&!n)throw new Error(\"Missing required arguments\");if(!d.string(e))throw new TypeError(\"Second argument must be a String\");if(!d.fn(n))throw new TypeError(\"Third argument must be a Function\");if(d.node(t))return s=e,f=n,(l=t).addEventListener(s,f),{destroy:function(){l.removeEventListener(s,f)}};if(d.nodeList(t))return a=t,c=e,u=n,Array.prototype.forEach.call(a,function(t){t.addEventListener(c,u)}),{destroy:function(){Array.prototype.forEach.call(a,function(t){t.removeEventListener(c,u)})}};if(d.string(t))return o=t,r=e,i=n,h(document.body,o,r,i);throw new TypeError(\"First argument must be a String, HTMLElement, HTMLCollection, or NodeList\");var o,r,i,a,c,u,l,s,f}},function(t,n){n.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},n.nodeList=function(t){var e=Object.prototype.toString.call(t);return void 0!==t&&(\"[object NodeList]\"===e||\"[object HTMLCollection]\"===e)&&\"length\"in t&&(0===t.length||n.node(t[0]))},n.string=function(t){return\"string\"==typeof t||t instanceof String},n.fn=function(t){return\"[object Function]\"===Object.prototype.toString.call(t)}},function(t,e,n){var a=n(7);function i(t,e,n,o,r){var i=function(e,n,t,o){return function(t){t.delegateTarget=a(t.target,n),t.delegateTarget&&o.call(e,t)}}.apply(this,arguments);return t.addEventListener(n,i,r),{destroy:function(){t.removeEventListener(n,i,r)}}}t.exports=function(t,e,n,o,r){return\"function\"==typeof t.addEventListener?i.apply(null,arguments):\"function\"==typeof n?i.bind(null,document).apply(null,arguments):(\"string\"==typeof t&&(t=document.querySelectorAll(t)),Array.prototype.map.call(t,function(t){return i(t,e,n,o,r)}))}},function(t,e){if(\"undefined\"!=typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}t.exports=function(t,e){for(;t&&9!==t.nodeType;){if(\"function\"==typeof t.matches&&t.matches(e))return t;t=t.parentNode}}}])});","type":"text"}]
