<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation layers in bSims • bSims</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation layers in bSims">
<script src="https://cdn.usefathom.com/script.js" data-site="KTMJHUPR" defer></script><link rel="icon" href="https://peter.solymos.org/favicon.ico">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bSims</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3-4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bsims01-intro.html">Introduction to the bSims package</a></li>
    <li><a class="dropdown-item" href="../articles/bsims02-layers.html">Simulation layers in bSims</a></li>
    <li><a class="dropdown-item" href="../articles/bsims03-workflow.html">Simulation workflow in bSims</a></li>
    <li><a class="dropdown-item" href="../articles/bsims04-apps.html">Explore bSims with Shiny apps</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.linkedin.com/in/peter-solymos/" aria-label="Linkedin"><span class="fa fa-linkedin"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/psolymos" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/psolymos" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation layers in bSims</h1>
                        <h4 data-toc-skip class="author">Peter
Solymos</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/psolymos/bSims/blob/master/vignettes/bsims02-layers.Rmd" class="external-link"><code>vignettes/bsims02-layers.Rmd</code></a></small>
      <div class="d-none name"><code>bsims02-layers.Rmd</code></div>
    </div>

    
    
<p>Introductory stats books begin with the coin flip to introduce the
binomial distribution. In R we can easily simulate an outcome from such
a random variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>∼</mo><mi>B</mi><mi>i</mi><mi>n</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>a</mi><mi>l</mi><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>p</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">Y \sim Binomial(1, p)</annotation></semantics></math>
doing something like this:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p>But a coin flip in reality is a lot more complicated: we might
consider the initial force, the height of the toss, the spin, and the
weight of the coin.</p>
<p>Bird behavior combined with the observation process presents a more
complicated system, that is often treated as a mixture of a count
distribution and a detection/nondetection process, e.g.:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># individuals / unit area</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># area</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.8</span> <span class="co"># probability of availability given presence</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># probability of detection given availability</span></span>
<span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>, lambda <span class="op">=</span> <span class="va">A</span> <span class="op">*</span> <span class="va">D</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, size <span class="op">=</span> <span class="va">N</span>, prob <span class="op">=</span> <span class="va">p</span> <span class="op">*</span> <span class="va">q</span><span class="op">)</span></span></code></pre></div>
<p>This looks not too complicated, corresponding to the true abundance
being a random variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>∼</mo><mi>P</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>n</mi><mo stretchy="false" form="prefix">(</mo><mi>D</mi><mi>A</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">N \sim Poisson(DA)</annotation></semantics></math>,
while the observed count being
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>∼</mo><mi>B</mi><mi>i</mi><mi>n</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>a</mi><mi>l</mi><mo stretchy="false" form="prefix">(</mo><mi>N</mi><mo>,</mo><mi>p</mi><mi>q</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">Y \sim Binomial(N, pq)</annotation></semantics></math>.
This is the exact simulation that we need when we want to make sure that
an <em>estimator</em> can estimate the <em>model</em> parameters
(<code>lambda</code> and <code>prob</code> here). But such probabilistic
simulations are not very useful when we are interested how well the
<em>model</em> captures important aspects of <em>reality</em>.</p>
<p>Going back to the Poisson–Binomial example, <code>N</code> would be a
result of all the factors influencing bird abundance, such as
geographical location, season, habitat suitability, number of
conspecifics, competitors, or predators. <code>Y</code> however would
largely depend on how the birds behave depending on timing, or how an
observer might detect or miss the different individuals, or count the
same individual twice, etc.</p>
<p>Therefore the package has layers, that by default are
<em>conditionally independent</em> of each other. This design decision
is meant to facilitate the comparison of certain settings while keeping
all the underlying realizations identical, thus helping to pinpoint
effects without the extra variability introduced by all the other
effects.</p>
<p>The conditionally independent <em>layers</em> of a
<strong>bSims</strong> realization are the following, with the
corresponding function:</p>
<ol style="list-style-type: decimal">
<li>landscape (<code>bsims_init</code>),</li>
<li>population (<code>bsims_populate</code>),</li>
<li>behavior with movement and vocalization events
(<code>bsims_animate</code>),</li>
<li>the physical side of the observation process
(<code>bsims_detect</code>), and</li>
<li>the human aspect of the observation process
(<code>bsims_transcribe</code>).</li>
</ol>
<p>See this example as a sneak peek that we’ll explain in the following
subsections:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/psolymos/bSims" class="external-link">bSims</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>                 <span class="co"># singing rate</span></span>
<span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>                 <span class="co"># detection distances by strata</span></span>
<span><span class="va">tbr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>         <span class="co"># time intervals</span></span>
<span><span class="va">rbr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span>      <span class="co"># count radii</span></span>
<span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_init</a></span><span class="op">(</span>extent<span class="op">=</span><span class="fl">10</span>, <span class="co"># landscape</span></span>
<span>  road<span class="op">=</span><span class="fl">0.25</span>, edge<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l</span>,     <span class="co"># population</span></span>
<span>  density<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_animate</a></span><span class="op">(</span><span class="va">p</span>,      <span class="co"># events</span></span>
<span>  vocal_rate<span class="op">=</span><span class="va">phi</span>,</span>
<span>  move_rate<span class="op">=</span><span class="fl">1</span>, movement<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_detect</a></span><span class="op">(</span><span class="va">e</span>,       <span class="co"># detections</span></span>
<span>  tau<span class="op">=</span><span class="va">tau</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_transcribe</a></span><span class="op">(</span><span class="va">d</span>,   <span class="co"># transcription</span></span>
<span>  tint<span class="op">=</span><span class="va">tbr</span>, rint<span class="op">=</span><span class="va">rbr</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/getters.html">get_table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># removal table</span></span>
<span><span class="co">#&gt;          0-3min 3-5min 5-10min</span></span>
<span><span class="co">#&gt; 0-50m         0      0       0</span></span>
<span><span class="co">#&gt; 50-100m       0      0       0</span></span>
<span><span class="co">#&gt; 100-150m      0      0       0</span></span>
<span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, cex.main<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">l</span>, main<span class="op">=</span><span class="st">"Initialize"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span>, main<span class="op">=</span><span class="st">"Populate"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">e</span>, main<span class="op">=</span><span class="st">"Animate"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span>, main<span class="op">=</span><span class="st">"Detect"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, main<span class="op">=</span><span class="st">"Transcribe"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/intro-1.png" width="100%"></p>
<div class="section level3">
<h3 id="landscape">Landscape<a class="anchor" aria-label="anchor" href="#landscape"></a>
</h3>
<p>The <code>bsims_ini</code> function sets up the geometry of a local
landscape. The <code>extent</code> of the landscape determines the edge
lengths of a square shaped area. With no argument values passed, the
function assumes a homogeneous <em>habitat</em> (H) in a 10 units x 10
units landscape, 1 unit is 100 meters. Having units this way allows
easier conversion to ha as area unit that is often used in the North
American bird literature. As a result, our landscape has an area of 1
km<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>2</mn></msup><annotation encoding="application/x-tex">^2</annotation></semantics></math>.</p>
<p>The <code>road</code> argument defines the half-width of the road
that is placed in a vertical position. The <code>edge</code> argument
defines the width of the edge stratum on both sides of the road. Habitat
(H), edge (E), and road (R) defines the 3 strata that we refer to by
their initials (H for no stratification, HER for all 3 strata
present).</p>
<p>The origin of the Cartesian coordinate system inside the landscape is
centered at the middle of the square. The <code>offset</code> argument
allows the road and edge strata to be shifted to the left (negative
values) or to the right (positive values) of the horizontal axis. This
makes it possible to create landscapes with only two strata. The
<code>bsims_init</code> function returns a landscape object (with class
‘bsims_landscape’).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_init</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="fl">10</span>, road <span class="op">=</span> <span class="fl">0</span>, edge <span class="op">=</span> <span class="fl">0</span>, offset <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims landscape</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: H</span></span>
<span><span class="op">(</span><span class="va">l2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_init</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="fl">10</span>, road <span class="op">=</span> <span class="fl">1</span>, edge <span class="op">=</span> <span class="fl">0</span>, offset <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims landscape</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: HR</span></span>
<span><span class="op">(</span><span class="va">l3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_init</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="fl">10</span>, road <span class="op">=</span> <span class="fl">0.5</span>, edge <span class="op">=</span> <span class="fl">1</span>, offset <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims landscape</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: HER</span></span>
<span><span class="op">(</span><span class="va">l4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_init</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="fl">10</span>, road <span class="op">=</span> <span class="fl">0</span>, edge <span class="op">=</span> <span class="fl">5</span>, offset <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims landscape</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: HE</span></span>
<span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">l1</span>, main <span class="op">=</span> <span class="st">"Habitat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, pch<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">l2</span>, main <span class="op">=</span> <span class="st">"Habitat &amp; road"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">l3</span>, main <span class="op">=</span> <span class="st">"Habitat, edge, road + offset"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, pch<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">l4</span>, main <span class="op">=</span> <span class="st">"2 habitats"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, pch<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/landscape-1.png" width="100%"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="population">Population<a class="anchor" aria-label="anchor" href="#population"></a>
</h3>
<p>The <code>bsims_populate</code> function <em>populates</em> the
landscape we created by the <code>bsims_init</code> function, which is
the first argument we have to pass to <code>bsims_populate</code>. The
function returns a population object (with class ‘bsims_population’).
The most important argument that controls how many individuals will
inhabit our landscape is <code>density</code> that defines the expected
value of individuals per unit area (1 ha). By default,
<code>density = 1</code>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">D=1</annotation></semantics></math>)
and we have 100 ha in the landscape
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">A=100</annotation></semantics></math>)
which translates into 100 individuals on average
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false" form="prefix">[</mo><mi>N</mi><mo stretchy="false" form="postfix">]</mo><mo>=</mo><mi>λ</mi><mo>=</mo><mi>A</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">E[N]=\lambda=AD</annotation></semantics></math>).
The actual number of individuals in the landscape might deviate from
this expectation, because
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is a random variable
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>∼</mo><mi>f</mi><mo stretchy="false" form="prefix">(</mo><mi>λ</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">N \sim f(\lambda)</annotation></semantics></math>).
The <code>abund_fun</code> argument controls this relationship between
the expected
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>)
and realized abundance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>).
The default is a Poisson distribution:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l1</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims population</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: H</span></span>
<span><span class="co">#&gt;   total abundance: 116</span></span></code></pre></div>
<p>Changing <code>abund_fun</code> can be useful to make abundance
constant or allow under or overdispersion, e.g.:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="co"># Poisson variation</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   72.00   94.75  100.50  101.01  107.25  130.00</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/rnegbin.html" class="external-link">rnegbin</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="co"># NegBin variation</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;     0.0    15.0    64.0   105.8   158.2   567.0</span></span>
<span><span class="va">negbin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambda</span>, <span class="va">...</span><span class="op">)</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/rnegbin.html" class="external-link">rnegbin</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l1</span>, abund_fun <span class="op">=</span> <span class="va">negbin</span>, theta <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims population</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: H</span></span>
<span><span class="co">#&gt;   total abundance: 58</span></span>
<span><span class="co">## constant abundance</span></span>
<span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l1</span>, abund_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambda</span>, <span class="va">...</span><span class="op">)</span> <span class="va">lambda</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims population</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: H</span></span>
<span><span class="co">#&gt;   total abundance: 100</span></span></code></pre></div>
<p>Once we determine how many individuals will populate the landscape,
we have control over the spatial arrangement of the nest location for
each individual. The default is a homogeneous Poisson point process
(complete spatial randomness). Deviations from this can be controlled by
the <code>xy_fun</code>. This function takes distance as its only
argument and returns a numeric value between 0 and 1. A function
<code>function(d) reurn(1)</code> would be equivalent with the Poisson
process, meaning that every new random location is accepted with
probability 1 irrespective of the distance between the new location and
the previously generated point locations in the landscape. When this
function varies with distance, it leads to a non-homogeneous point
process via this accept-reject algorithm. The other arguments
(<code>margin</code>, <code>maxit</code>, <code>fail</code>) are passed
to the underlying <code>accepreject</code> function to remove edge
effects and handle high rejection rates.</p>
<p>In the next example, we fix the abundance to be constant (i.e. not a
random variable,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mi>λ</mi></mrow><annotation encoding="application/x-tex">N=\lambda</annotation></semantics></math>)
and different spatial point processes:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">f_abund</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambda</span>, <span class="va">...</span><span class="op">)</span> <span class="va">lambda</span></span>
<span></span>
<span><span class="co">## systematic</span></span>
<span><span class="va">f_syst</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span>  <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">d</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="va">d</span>, <span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">2</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="co">## clustered</span></span>
<span><span class="va">f_clust</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">d</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">d</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">4</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l1</span>, density <span class="op">=</span> <span class="va">D</span>, abund_fun <span class="op">=</span> <span class="va">f_abund</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l1</span>, density <span class="op">=</span> <span class="va">D</span>, abund_fun <span class="op">=</span> <span class="va">f_abund</span>, xy_fun <span class="op">=</span> <span class="va">f_syst</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l1</span>, density <span class="op">=</span> <span class="va">D</span>, abund_fun <span class="op">=</span> <span class="va">f_abund</span>, xy_fun <span class="op">=</span> <span class="va">f_clust</span><span class="op">)</span></span>
<span></span>
<span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">distance</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"random"</span>, ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">distance</span>, <span class="fu">f_syst</span><span class="op">(</span><span class="va">distance</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"systematic"</span>, ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">distance</span>, <span class="fu">f_clust</span><span class="op">(</span><span class="va">distance</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"clustered"</span>, ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/pop-xy-1.png" width="576"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
<p>The <code>get_nests</code> function extracts the nest locations.
<code>get_abundance</code> and <code>get_density</code> gives the total
abundance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>)
and density
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mi>N</mi><mi>/</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">D=N/A</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
is <code>extent^2</code>) in the landscape, respectively.</p>
<p>If the landscape is stratified, that has no effect on density unless
we specify different values through the <code>density</code> argument as
a vector of length 3 referring to the HER strata:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>H <span class="op">=</span> <span class="fl">2</span>, E <span class="op">=</span> <span class="fl">0.5</span>, R <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l1</span>, density <span class="op">=</span> <span class="va">D</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Habitat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l2</span>, density <span class="op">=</span> <span class="va">D</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Habitat &amp; road"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l3</span>, density <span class="op">=</span> <span class="va">D</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Habitat, edge, road + offset"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l4</span>, density <span class="op">=</span> <span class="va">D</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"2 habitats"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/pop-dens-1.png" width="100%"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="behavior">Behavior<a class="anchor" aria-label="anchor" href="#behavior"></a>
</h3>
<p>The <code>bsims_animate</code> function <em>animates</em> the
population created by the <code>bsims_populate</code> function.
<code>bsims_animate</code> returns an events object (with class
‘bsims_events’). The most important arguments are governing the
<code>duration</code> of the simulation in minutes, the vocalization
(<code>vocal_rate</code>), and the movement (<code>move_rate</code>)
rates as average number of events per minute.</p>
<p>We can describe these behavioral events using survival modeling
terminology. Event time
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>)
is a continuous random variable. In the simplest case, its probability
density function is the Exponential distribution:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mi>ϕ</mi><msup><mi>e</mi><mrow><mi>−</mi><mi>t</mi><mi>ϕ</mi></mrow></msup></mrow><annotation encoding="application/x-tex">f(t)=\phi e^{-t\phi}</annotation></semantics></math>.
The corresponding cumulative distribution function is:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><mi>f</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mi>d</mi><mi>t</mi><mo>=</mo><mn>1</mn><mo>−</mo><msup><mi>e</mi><mrow><mi>−</mi><mi>t</mi><mi>ϕ</mi></mrow></msup><mo>=</mo><msub><mi>p</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">F(t)=\int_{0}^{t} f(t)dt=1-e^{-t\phi}=p_t</annotation></semantics></math>,
giving the probability that the event has occurred by duration
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is the rate of the Exponential distribution with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">1/\phi</annotation></semantics></math>
and variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><msup><mi>ϕ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">1/\phi^2</annotation></semantics></math>.</p>
<p>In survival models, the complement of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">F(t)</annotation></semantics></math>
is called the <em>survival function</em>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mn>1</mn><mo>−</mo><mi>F</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">S(t)=1-F(t)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">S(0)=1</annotation></semantics></math>),
which gives the probability that the event has not occurred by duration
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The <em>hazard function</em>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mi>f</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mi>/</mi><mi>S</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\lambda(t)=f(t)/S(t)</annotation></semantics></math>)
defines the instantaneous rate of occurrence of the event (risk, the
density of events at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
divided by the probability of surviving). The cumulative hazard
(cumulative risk) is the sum of the risks between duration 0 and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Λ</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><mi>λ</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\Lambda(t)=\int_{0}^{t} \lambda(t)dt</annotation></semantics></math>).</p>
<p>The simplest survival distribution assumes constant risk over time
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\lambda(t)=\phi</annotation></semantics></math>),
which corresponds to the Exponential distribution. The Exponential
distribution also happens to describe the lengths of the inter-event
times in a homogeneous Poisson process (events are independent, it is a
‘memory-less’ process).</p>
<p><code>bsims_animate</code> uses independent Exponential distributions
with rates <code>vocal_rate</code> and <code>move_rate</code> to
simulate vocalization and movement events, respectively. The
<code>get_events</code> function extracts the events as a data frame
with columns describing the location (<code>x</code>, <code>y</code>)
and time (<code>t</code>) of the events (<code>v</code> is 1 for
vocalizations and 0 otherwise) for each individual (<code>i</code> gives
the individual identifier that links individuals to the nest
locations)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_init</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l</span>, density <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">e1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_animate</a></span><span class="op">(</span><span class="va">p</span>, vocal_rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/getters.html">get_events</a></span><span class="op">(</span><span class="va">e1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            x          y           t v   a  i</span></span>
<span><span class="co">#&gt; 1 -1.0695308 -0.7160919 0.005626468 1 108 10</span></span>
<span><span class="co">#&gt; 2  2.4040573  1.3196873 0.022987967 1 314 36</span></span>
<span><span class="co">#&gt; 3  1.9208075  2.2174483 0.044264103 1 276 21</span></span>
<span><span class="co">#&gt; 4 -1.9400019  1.1727845 0.076256107 1 123  9</span></span>
<span><span class="co">#&gt; 5 -2.0071394 -3.4967963 0.084058107 1 178  3</span></span>
<span><span class="co">#&gt; 6 -0.6696711 -4.1261427 0.161096144 1  86  6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/getters.html">get_events</a></span><span class="op">(</span><span class="va">e1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="../reference/getters.html">get_abundance</a></span><span class="op">(</span><span class="va">e1</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">2</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/beh-events-1.png" width="576"></p>
<p>There are no movement related events when <code>move_rate = 0</code>,
the individuals are always located at the nest, i.e. there is no within
territory movement. If we increase the movement rate, we also have to
increase the value of <code>movement</code>, that is the standard
deviation of bivariate Normal kernels centered around each nest
location. This kernel is used to simulate new locations for the movement
events.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_animate</a></span><span class="op">(</span><span class="va">p</span>, move_rate <span class="op">=</span> <span class="fl">1</span>, movement <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">e1</span>, main <span class="op">=</span> <span class="st">"Closure"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">e2</span>, main <span class="op">=</span> <span class="st">"Movement"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/beh-move-1.png" width="100%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
<p>Individuals in the landscape might have different vocalization rates
depending on, e.g., breeding status. Such heterogeneity can be added to
the simulations as a finite mixture: <code>vocal_rate</code> and
<code>move_rate</code> can be supplied as a vector, each element giving
the rate for the groups. The <code>mixture</code> argument is then used
to specify the mixture proportions.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_animate</a></span><span class="op">(</span><span class="va">p</span>, </span>
<span>  vocal_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">1</span><span class="op">)</span>, mixture <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33</span>, <span class="fl">0.67</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/getters.html">get_events</a></span><span class="op">(</span><span class="va">e3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.67</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="../reference/getters.html">get_abundance</a></span><span class="op">(</span><span class="va">e3</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">2</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/beh-mix-1.png" width="576"></p>
<p>Vocal and movement rates (and corresponding kernel standard
deviations) can be defined four different ways:</p>
<ul>
<li>a single number: constant behavior patterns, no groups,</li>
<li>a vector of length <code>length(mixture)</code>: behavior based
finite mixture groups,</li>
<li>a vector of length 3 with <code>mixture = 1</code>: mixtures
correspond to HER strata,</li>
<li>or a matrix of dimension 3
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math><code>length(mixture)</code>: HER strata
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math>
number of behavior based groups.</li>
</ul>
<p>Strata based groups are tracked by column <code>s</code>, behavior
based groups are tracked as the column <code>g</code> in the output of
<code>get_nests</code>.</p>
<p>Here is how different territory sizes can be achieved in a
two-habitat landscape:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_animate</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l4</span>, density <span class="op">=</span> <span class="va">D</span><span class="op">)</span>, </span>
<span>  move_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, movement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span>, </span>
<span>  mixture <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Strata based mixtures"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/beh-move2-1.png" width="480"></p>
<p>Stratum related behavior groups depend on the nest location.
Sometimes it makes sense to restrict movement even further,
i.e. individuals do not land in certain strata (but can cross a stratum
if <code>movement</code> is large enough). For example, we can restrict
movement into the road stratum (this requires density to be 0 in that
stratum):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_animate</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l2</span>, density <span class="op">=</span> <span class="va">D</span><span class="op">)</span>, </span>
<span>  move_rate <span class="op">=</span> <span class="fl">1</span>, movement <span class="op">=</span> <span class="fl">0.3</span>, </span>
<span>  avoid <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Movement not restricted"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_animate</a></span><span class="op">(</span><span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l2</span>, density <span class="op">=</span> <span class="va">D</span><span class="op">)</span>, </span>
<span>  move_rate <span class="op">=</span> <span class="fl">1</span>, movement <span class="op">=</span> <span class="fl">0.3</span>, </span>
<span>  avoid <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Movement restricted"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/beh-move3-1.png" width="100%"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
<p>Another way to restrict the movement of individuals is to prevent the
overlap based on a Voronoi tessellation around the nest locations. Note:
we are using the update method here to update the
<code>allow_overlap</code> argument of the previous call, and the plot
method from the <strong>deldir</strong> package used for
tessellation.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">e2</span>, allow_overlap<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">e2</span>, main <span class="op">=</span> <span class="st">"Overlap"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">e2</span><span class="op">$</span><span class="va">tess</span>, add<span class="op">=</span><span class="cn">TRUE</span>, wlines<span class="op">=</span><span class="st">"tess"</span>,</span>
<span>  showpoints<span class="op">=</span><span class="cn">FALSE</span>, cmpnt_lty<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">e4</span>, main <span class="op">=</span> <span class="st">"No overlap"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">e4</span><span class="op">$</span><span class="va">tess</span>, add<span class="op">=</span><span class="cn">TRUE</span>, wlines<span class="op">=</span><span class="st">"tess"</span>,</span>
<span>  showpoints<span class="op">=</span><span class="cn">FALSE</span>, cmpnt_lty<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/beh-move4-1.png" width="100%"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
<p>We haven’t mentioned the <code>initial_location</code> argument yet.
This allows to override this whole layer and make all individuals fully
available for the other layers applied on top. I.e. it is possible to
study the observation process without any behavioral interference when
<code>initial_location = TRUE</code>.</p>
</div>
<div class="section level3">
<h3 id="detection">Detection<a class="anchor" aria-label="anchor" href="#detection"></a>
</h3>
<p>The <code>bsims_detect</code> function <em>detects</em> the events
created by the <code>bsims_animate</code> function.
<code>bsims_detect</code> returns a detections object (with class
‘bsims_detections’). The argument <code>xy</code> defines the location
of the observer in the landscape. By default, it is in the middle, but
can be moved anywhere within the bounds of the landscape.</p>
<p><code>tau</code> is the parameter of the distance function
<code>dist_fun</code>. The distance function
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false" form="prefix">(</mo><mi>d</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">g(d)</annotation></semantics></math>)
describes the monotonic relationship of how the probability of detecting
an individual decreases with distance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>).
Detection probability at 0 distance is 1.</p>
<p>The most commonly used distance function is the Half-Normal. This is
a one-parameter function
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false" form="prefix">(</mo><mi>d</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><msup><mi>e</mi><mrow><mi>−</mi><mo stretchy="false" form="prefix">(</mo><mi>d</mi><mi>/</mi><mi>τ</mi><msup><mo stretchy="false" form="postfix">)</mo><mn>2</mn></msup></mrow></msup></mrow><annotation encoding="application/x-tex">g(d) = e^{-(d/\tau)^2}</annotation></semantics></math>)
where probability initially remain high, reflecting an increased chance
of detecting individuals closer to the observer
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>τ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\tau^2</annotation></semantics></math>
is variance of the unfolded Normal distribution,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>τ</mi><mn>2</mn></msup><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\tau^2/2</annotation></semantics></math>
is the variance of the Half-Normal distribution). Run
<code>run_app("distfunH")</code> to launch a <strong>shiny</strong> app
to explore different distance functions, like Hazard rate.</p>
<p>The distance function must take distance <code>d</code> as its 1st
argument and the parameter <code>tau</code> is its second argument
(other arguments can be passed as well). E.g. the default is
<code>function(d, tau) exp(-(d/tau)^2)</code>, or the Hazard rate
function can be written as
<code>function(d, tau, b=2) 1-exp(-(d/tau)^-b)</code>.</p>
<p>Individuals are detected via auditory and visual cues that are
related to vocalization or movement events, respectively. The
<code>event_type</code> argument determines what kinds of events can be
detected, vocalization, movement, or both. Detection here refers to the
Bernoulli process with probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false" form="prefix">(</mo><mi>d</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">g(d)</annotation></semantics></math>
given the actual linear distance between the individual at that time and
the observer. The <code>get_detections</code> function extracts the
events that are detected, the column <code>d</code> contains the
distances (in 100 m units).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_detect</a></span><span class="op">(</span><span class="va">e2</span>, tau <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims detections</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: H</span></span>
<span><span class="co">#&gt;   total abundance: 43</span></span>
<span><span class="co">#&gt;   duration: 10 min</span></span>
<span><span class="co">#&gt;   detected: 14 heard</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/getters.html">get_detections</a></span><span class="op">(</span><span class="va">d1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             x          y         t v   a         d  f  i  j</span></span>
<span><span class="co">#&gt; 59   1.033834 -0.5436307 0.6992886 1 248 1.1680526 NA 37 37</span></span>
<span><span class="co">#&gt; 67  -1.473937  1.0003945 0.7579134 1 350 1.7813703 NA 12 12</span></span>
<span><span class="co">#&gt; 70   1.033834 -0.5436307 0.8413722 1 234 1.1680526 NA 37 37</span></span>
<span><span class="co">#&gt; 91  -1.088111 -0.3823201 1.1195392 1 287 1.1533228 NA 10 10</span></span>
<span><span class="co">#&gt; 104 -2.237350 -1.1170397 1.2695494 1 247 2.5007026 NA  1  1</span></span>
<span><span class="co">#&gt; 156  0.751192 -0.5472666 1.8167910 1 143 0.9294032 NA 37 37</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d1</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/det-1.png" width="480"></p>
<p>The <code>tau</code> argument can be a vector of length 3, referring
to detection distances in the HER strata. When the landscape is
stratified, and detection distances are different among the strata the
<code>bsims_detect</code> function uses a segmented attenuation model
along the linear distance between the bird and the observer. The
<code>run_app("distfunHER")</code> <strong>shiny</strong> explores the
segmented attenuation.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">dist_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">d</span><span class="op">/</span><span class="va">tau</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="co"># half normal</span></span>
<span><span class="co">#dist_fun &lt;- function(d, tau) exp(-d/tau) # exponential</span></span>
<span><span class="co">#dist_fun &lt;- function(d, tau) 1-exp(-(d/tau)^-2) # hazard rate</span></span>
<span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span> <span class="co">#  boundaries</span></span>
<span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">dist_fun</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"n"</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"g(d)"</span>, xlab<span class="op">=</span><span class="st">"d (100 m)"</span>, axes<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>  main<span class="op">=</span><span class="st">"Sound travels from left to right"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">b</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">b</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">b</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">i</span>, <span class="va">i</span><span class="op">+</span><span class="fl">1</span>, <span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    border<span class="op">=</span><span class="cn">NA</span>,</span>
<span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkolivegreen1"</span>, <span class="st">"burlywood1"</span>, <span class="st">"lightgrey"</span>,</span>
<span>    <span class="st">"burlywood1"</span>, <span class="st">"darkolivegreen1"</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">dist_fun</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">dist_fun</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">dist_fun</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span>, <span class="va">dist_fun</span>, <span class="va">b</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">2</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">dist_fun</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"n"</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"g(d)"</span>, xlab<span class="op">=</span><span class="st">"d (100 m)"</span>, axes<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>  main<span class="op">=</span><span class="st">"Sound travels from right to left"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">b</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">b</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">b</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">i</span>, <span class="va">i</span><span class="op">+</span><span class="fl">1</span>, <span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    border<span class="op">=</span><span class="cn">NA</span>,</span>
<span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkolivegreen1"</span>, <span class="st">"burlywood1"</span>, <span class="st">"lightgrey"</span>,</span>
<span>    <span class="st">"burlywood1"</span>, <span class="st">"darkolivegreen1"</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">dist_fun</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">dist_fun</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">dist_fun</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, <span class="fu"><a href="../reference/dist_fun2.html">dist_fun2</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">tau</span>, <span class="va">dist_fun</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fl">4</span><span class="op">-</span><span class="va">b</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">2</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/segm-1.png" width="576"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_animate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/bsims_init.html">bsims_init</a></span><span class="op">(</span>road <span class="op">=</span> <span class="fl">0.2</span>, edge <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>, density <span class="op">=</span> <span class="va">D</span><span class="op">)</span>, </span>
<span>  move_rate <span class="op">=</span> <span class="fl">1</span>, movement <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_detect</a></span><span class="op">(</span><span class="va">e5</span>, tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, event_type <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims detections</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: HER</span></span>
<span><span class="co">#&gt;   total abundance: 169</span></span>
<span><span class="co">#&gt;   duration: 10 min</span></span>
<span><span class="co">#&gt;   detected: 42 seen/heard</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/getters.html">get_detections</a></span><span class="op">(</span><span class="va">d2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             x           y          t v   a         d  f  i  j</span></span>
<span><span class="co">#&gt; 5  -0.9776217  1.36502323 0.01223095 0  NA 1.6789975 NA 13 13</span></span>
<span><span class="co">#&gt; 18  0.7590823 -0.09204728 0.04171113 1  20 0.7646429 NA 93 93</span></span>
<span><span class="co">#&gt; 32  0.7199966 -0.18819715 0.08127040 0  NA 0.7441863 NA 93 93</span></span>
<span><span class="co">#&gt; 37 -1.5615347  0.99025837 0.09535332 1 352 1.8490544 NA  6  6</span></span>
<span><span class="co">#&gt; 43 -0.5873458  0.67553887 0.11854136 0  NA 0.8951692 NA 33 33</span></span>
<span><span class="co">#&gt; 80  0.7199966 -0.18819715 0.24575458 1 124 0.7441863 NA 93 93</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d2</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/det2-1.png" width="480"></p>
<p>If you notice in the plot here, the detections (lines connecting the
observer and the location of the events being detected) are 2 different
colors. That’s because we allowed both vocalization and movement event
types to be detected via the <code>event_type = "both"</code> argument.
Vocalization and movement related detections might have different
detection function characteristics. A flyover might be seen from larger
distances, but it can also depend on body size and coloration relative
to the background. For this reason, the <code>tau</code> argument can
also be a vector of length 2 to provide parameters for vocalization (1st
value) and movement (2nd value) related events.</p>
<p>Let’s use the <code>e2</code> object (no landscape stratification)
and see how many individuals are hear (not seen), seen (not heard), and
heard &amp; seen:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">d3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_detect</a></span><span class="op">(</span><span class="va">e2</span>, tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">3</span><span class="op">)</span>, event_type <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims detections</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: H</span></span>
<span><span class="co">#&gt;   total abundance: 43</span></span>
<span><span class="co">#&gt;   duration: 10 min</span></span>
<span><span class="co">#&gt;   detected: 30 seen/heard</span></span>
<span></span>
<span><span class="va">dtab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getters.html">get_detections</a></span><span class="op">(</span><span class="va">d3</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dtab</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">v</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"heard"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span>,<span class="st">"0"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">tmp</span><span class="op">[</span>,<span class="st">"1"</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  <span class="st">"seen"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span>,<span class="st">"0"</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">tmp</span><span class="op">[</span>,<span class="st">"1"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  <span class="st">"heard &amp; seen"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span>,<span class="st">"0"</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">tmp</span><span class="op">[</span>,<span class="st">"1"</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        heard         seen heard &amp; seen </span></span>
<span><span class="co">#&gt;            1           23            6</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d3</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/det3-1.png" width="480"></p>
<p><code>tau</code> given as a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">3 \times 2</annotation></semantics></math>
matrix combines strata (rows) and vocalization/movement (columns)
related parameters, thus allowing the distance function to differ among
the three strata and distinguish the event types.</p>
<p>The <code>sensitivity</code> argument modifies <code>tau</code>
(<code>tau * sensitivity</code>), it can be specified for movement or
vocal events.This is a more didactic way of introducing observer or
sensor related variability into the detection process. It is still the
physical process that is being affected and not the perception.</p>
</div>
<div class="section level3">
<h3 id="transcription">Transcription<a class="anchor" aria-label="anchor" href="#transcription"></a>
</h3>
<p>The last layer of simulation is the <code>bsims_transcribe</code>
function that <em>transcribes</em> the detections created by the
<code>bsims_detect</code> function. <code>bsims_transcribe</code>
returns a detections object (with class ‘bsims_transcript’). This layer
refers to the process of the observer assigning detected individuals to
time and distance categories. The <code>tint</code> argument is a vector
containing the endpoints of the time intervals within the total duration
in minutes. <code>rint</code> defines the distance bands in 100 m units,
the maximum can be infinite referring to an unlimited distance
count.</p>
<p>The <code>error</code> argument refers to distance estimation error.
This does not impact the actual distance between the bird and the
observer, but it can lead to misclassification of the distance interval
where the individual is assigned. The argument is the log scale standard
deviation for lognormally distributed random variable representing this
error.</p>
<p>The <code>condition</code> argument defines which events will be
transcribed: <code>"event1"</code> refers to the 1st event (detected or
not), <code>"det1"</code> refers to the 1st detection,
<code>"alldet"</code> means all detections (possibly counting the same
individual multiple times). The <code>event_type</code> argument can be
redefined here, too.</p>
<p><code>perception</code> creates individual identifiers as perceived
by the observer. The argument defines the perceived number of
individuals relative to the actual number of individuals. It can be a
non-negative number (&lt;1 values lead to under counting, &gt;1 values
lead to over counting), or <code>NULL</code> (observer correctly
identifies all individuals). The algorithm uses the event based
locations in a hierarchical clustering. The dendrogram is cut at a
height corresponding to specified <code>perception</code> level and
group membership is used as individual identifier.</p>
<p>The <code>bsims_transcribe</code> eventually prepares a ‘removal’
table that counts the new individuals in each time/distance interval.
This table is used in removal and distance sampling. The ‘visits’ table
counts individuals by time and distance interval, but counting restarts
in every time interval (i.e. not just the new individuals are counted).
The plot method overlays the distance bands and a representation of the
time intervals.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_transcribe</a></span><span class="op">(</span><span class="va">d1</span>,</span>
<span>  tint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>  rint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; bSims transcript</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: H</span></span>
<span><span class="co">#&gt;   total abundance: 43</span></span>
<span><span class="co">#&gt;   duration: 10 min</span></span>
<span><span class="co">#&gt;   detected: 14 heard</span></span>
<span><span class="co">#&gt;   1st event detected by breaks:</span></span>
<span><span class="co">#&gt;     [0, 2, 4, 6, 8, 10 min]</span></span>
<span><span class="co">#&gt;     [0, 50, 100, 150, Inf m]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/trans-1.png" width="576"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/getters.html">get_table</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"removal"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          0-2min 2-4min 4-6min 6-8min 8-10min</span></span>
<span><span class="co">#&gt; 0-50m         0      0      0      0       0</span></span>
<span><span class="co">#&gt; 50-100m       0      1      0      0       0</span></span>
<span><span class="co">#&gt; 100-150m      2      0      0      0       0</span></span>
<span><span class="co">#&gt; 150+m         2      0      0      0       0</span></span>
<span><span class="fu"><a href="../reference/getters.html">get_table</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"visits"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          0-2min 2-4min 4-6min 6-8min 8-10min</span></span>
<span><span class="co">#&gt; 0-50m         0      0      0      0       0</span></span>
<span><span class="co">#&gt; 50-100m       0      1      3      0       0</span></span>
<span><span class="co">#&gt; 100-150m      2      0      0      1       2</span></span>
<span><span class="co">#&gt; 150+m         2      2      3      2       1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="statistical-validity-of-the-simulations">Statistical validity of the simulations<a class="anchor" aria-label="anchor" href="#statistical-validity-of-the-simulations"></a>
</h2>
<p>We can test the validity of the simulations when all of the
assumptions are met (that is the default) in the homogeneous habitat
case. We set singing rate (<code>phi</code>), detection distance
(<code>tau</code>), and density (<code>Den</code>) for the simulations.
Density is in this case unrealistically high, because we are not using
replication only a single landscape. This will help with the
estimation.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># singing rate</span></span>
<span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">2</span>   <span class="co"># detection distance</span></span>
<span><span class="va">Den</span> <span class="op">&lt;-</span> <span class="fl">10</span>  <span class="co"># density</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_init</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_populate</a></span><span class="op">(</span><span class="va">l</span>, density<span class="op">=</span><span class="va">Den</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_animate</a></span><span class="op">(</span><span class="va">a</span>, vocal_rate<span class="op">=</span><span class="va">phi</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_detect</a></span><span class="op">(</span><span class="va">b</span>, tau<span class="op">=</span><span class="va">tau</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">rint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># truncated at 200 m</span></span>
<span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_transcribe</a></span><span class="op">(</span><span class="va">o</span>, tint<span class="op">=</span><span class="va">tint</span>, rint<span class="op">=</span><span class="va">rint</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims transcript</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: H</span></span>
<span><span class="co">#&gt;   total abundance: 1014</span></span>
<span><span class="co">#&gt;   duration: 10 min</span></span>
<span><span class="co">#&gt;   detected: 289 heard</span></span>
<span><span class="co">#&gt;   1st event detected by breaks:</span></span>
<span><span class="co">#&gt;     [0, 1, 2, 3, 4, 5 min]</span></span>
<span><span class="co">#&gt;     [0, 50, 100, 150, 200 m]</span></span>
<span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getters.html">get_table</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"removal"</span><span class="op">)</span><span class="op">)</span> <span class="co"># binned new individuals</span></span>
<span><span class="co">#&gt;          0-1min 1-2min 2-3min 3-4min 4-5min</span></span>
<span><span class="co">#&gt; 0-50m         1      4      1      1      1</span></span>
<span><span class="co">#&gt; 50-100m      10      5      3      0      1</span></span>
<span><span class="co">#&gt; 100-150m      9      5      4      2      0</span></span>
<span><span class="co">#&gt; 150-200m     12      5      4      1      1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0-1min 1-2min 2-3min 3-4min 4-5min </span></span>
<span><span class="co">#&gt;     32     19     12      4      3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt;    0-50m  50-100m 100-150m 150-200m </span></span>
<span><span class="co">#&gt;        8       19       20       23</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<p><img src="bsims02-layers_files/figure-html/H-1.png" width="480"></p>
<p>We use the <strong>detect</strong> package to fit removal model and
distance sampling model to the simulated output. This is handily
implemented in the <code>estimate</code> method for the transcription
objects. First, we estimate singing rate, effective detection distance,
and density based on truncated distance counts:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/psolymos/detect" class="external-link">detect</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Formula</span></span>
<span><span class="co">#&gt; Loading required package: stats4</span></span>
<span><span class="co">#&gt; Loading required package: pbapply</span></span>
<span><span class="co">#&gt; detect 0.5-0      2025-08-31</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>true <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>phi<span class="op">=</span><span class="va">phi</span>, tau<span class="op">=</span><span class="va">tau</span>, D<span class="op">=</span><span class="va">Den</span><span class="op">)</span>, </span>
<span>  estimate <span class="op">=</span> <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in cbind(true = c(phi = phi, tau = tau, D = Den), estimate =</span></span>
<span><span class="co">#&gt; estimate(x)): number of rows of result is not a multiple of vector length (arg</span></span>
<span><span class="co">#&gt; 1)</span></span>
<span><span class="co">#&gt;                true   estimate</span></span>
<span><span class="co">#&gt; density         0.5  9.7047484</span></span>
<span><span class="co">#&gt; area            2.0 12.5663706</span></span>
<span><span class="co">#&gt; cue_rate       10.0  0.5979187</span></span>
<span><span class="co">#&gt; distance_param  0.5  1.8996806</span></span></code></pre></div>
<p>Next, we estimate singing rate, effective detection distance, and
density based on unlimited distance counts:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span>, <span class="cn">Inf</span><span class="op">)</span> <span class="co"># unlimited</span></span>
<span></span>
<span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsims_init.html">bsims_transcribe</a></span><span class="op">(</span><span class="va">o</span>, tint<span class="op">=</span><span class="va">tint</span>, rint<span class="op">=</span><span class="va">rint</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bSims transcript</span></span>
<span><span class="co">#&gt;   1 km x 1 km</span></span>
<span><span class="co">#&gt;   stratification: H</span></span>
<span><span class="co">#&gt;   total abundance: 1014</span></span>
<span><span class="co">#&gt;   duration: 10 min</span></span>
<span><span class="co">#&gt;   detected: 289 heard</span></span>
<span><span class="co">#&gt;   1st event detected by breaks:</span></span>
<span><span class="co">#&gt;     [0, 1, 2, 3, 4, 5 min]</span></span>
<span><span class="co">#&gt;     [0, 50, 100, 150, 200, Inf m]</span></span>
<span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getters.html">get_table</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"removal"</span><span class="op">)</span><span class="op">)</span> <span class="co"># binned new individuals</span></span>
<span><span class="co">#&gt;          0-1min 1-2min 2-3min 3-4min 4-5min</span></span>
<span><span class="co">#&gt; 0-50m         1      4      1      1      1</span></span>
<span><span class="co">#&gt; 50-100m      10      5      3      0      1</span></span>
<span><span class="co">#&gt; 100-150m      9      5      4      2      0</span></span>
<span><span class="co">#&gt; 150-200m     12      5      4      1      1</span></span>
<span><span class="co">#&gt; 200+m        15      9      6      1      3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0-1min 1-2min 2-3min 3-4min 4-5min </span></span>
<span><span class="co">#&gt;     47     28     18      5      6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt;    0-50m  50-100m 100-150m 150-200m    200+m </span></span>
<span><span class="co">#&gt;        8       19       20       23       34</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>true <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>phi<span class="op">=</span><span class="va">phi</span>, tau<span class="op">=</span><span class="va">tau</span>, D<span class="op">=</span><span class="va">Den</span><span class="op">)</span>, </span>
<span>  estimate <span class="op">=</span> <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in cbind(true = c(phi = phi, tau = tau, D = Den), estimate =</span></span>
<span><span class="co">#&gt; estimate(x)): number of rows of result is not a multiple of vector length (arg</span></span>
<span><span class="co">#&gt; 1)</span></span>
<span><span class="co">#&gt;                true   estimate</span></span>
<span><span class="co">#&gt; density         0.5  9.8040797</span></span>
<span><span class="co">#&gt; area            2.0 11.2483778</span></span>
<span><span class="co">#&gt; cue_rate       10.0  0.5731308</span></span>
<span><span class="co">#&gt; distance_param  0.5  1.8922130</span></span></code></pre></div>
<p>Deviations from the assumptions and bias in density estimation can be
done by systematically evaluating the simulations settings, which we
describe in the next section.</p>
<p>Read more in the paper:</p>
<p>Solymos, P. 2023. Agent-based simulations improve abundance
estimation. <em>Biologia Futura</em> 74, 377–392 <a href="https://doi.org/10.1007/s42977-023-00183-2" class="external-link">DOI
10.1007/s42977-023-00183-2</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Peter Solymos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
