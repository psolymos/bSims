<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the bSims package • bSims</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the bSims package">
<meta property="og:description" content="bSims">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bSims</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to the bSims package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/psolymos/bSims/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the bSims package</h1>
                        <h4 class="author">Peter Solymos</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/psolymos/bSims/blob/master/vignettes/intro.Rmd"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The <strong>bSims</strong> R package is a <em>highly scientific</em> and <em>utterly addictive</em> bird point count simulator. Highly scientific, because it implements a spatially explicit mechanistic simulation that is based on statistical models widely used in bird point count analysis (i.e. removal models, distance sampling), and utterly addictive because the implementation is designed to allow rapid interactive exploration (via <strong>shiny</strong> apps) and efficient simulation (supporting various parallel backends), thus elevating the user experience.</p>
<p>The goals of the package are to:</p>
<ol style="list-style-type: decimal">
<li>allow easy <em>testing of statistical assumptions</em> and explore effects of violating these assumptions,</li>
<li>
<em>aid survey design</em> by comparing different options,</li>
<li>and most importantly, to <em>have fun</em> while doing it via an intuitive and interactive user interface.</li>
</ol>
<p>The simulation interface was designed with the following principles in mind:</p>
<ol style="list-style-type: decimal">
<li>
<em>isolation</em>: the spatial scale is small (local point count scale) so that we can treat individual landscapes as more or less homogeneous units (but see below how certain stratified designs and edge effects can be incorporated) and independent in space and time;</li>
<li>
<em>realism</em>: the implementation of biological mechanisms and observation processes are realistic, defaults are chosen to reflect common practice and assumptions;</li>
<li>
<em>efficiency</em>: implementation is computationally efficient utilizing parallel computing backends when available;</li>
<li>
<em>extensibility</em>: the package functionality is well documented and easily extensible.</li>
</ol>
<p>This documents outlines the major functionality of the package. First we describe the motivation for the simulation and the details of the layers. Then we outline an interactive workflow to design simulation studies and describe how to run efficient simulation experiments. Finally we present some of the current limitations of the framework and how to extend the existing functionality of the package to incorporate more of the biological realism into the simulations.</p>
</div>
<div id="simulation-layers" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-layers" class="anchor"></a>Simulation layers</h2>
<p>Introductory stats books begin with the coin flip to introduce the binomial distribution. In R we can easily simulate an outcome from such a random variable <span class="math inline">\(Y \sim Binomial(1, p)\)</span> doing something like this:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">p</span> <span class="kw">&lt;-</span> <span class="fl">0.5</span>

<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="fl">1</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="no">p</span>)</pre></body></html></div>
<p>But a coin flip in reality is a lot more complicated: we might consider the initial force, the height of the toss, the spin, and the weight of the coin.</p>
<p>Bird behavior combined with the observation process presents a more complicated system, that is often treated as a mixture of a count distribution and a detection/nondetection process, e.g.:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">D</span> <span class="kw">&lt;-</span> <span class="fl">2</span> <span class="co"># individuals / unit area</span>
<span class="no">A</span> <span class="kw">&lt;-</span> <span class="fl">1</span> <span class="co"># area</span>
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fl">0.8</span> <span class="co"># probability of availability given presence</span>
<span class="no">q</span> <span class="kw">&lt;-</span> <span class="fl">0.5</span> <span class="co"># probability of detection given availability</span>

<span class="no">N</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(<span class="fl">1</span>, <span class="kw">lambda</span> <span class="kw">=</span> <span class="no">A</span> * <span class="no">D</span>)
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="fl">1</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="no">N</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="no">p</span> * <span class="no">q</span>)</pre></body></html></div>
<p>This looks not too complicated, corresponding to the true abundance being a random variables <span class="math inline">\(N \sim Poisson(DA)\)</span>, while the observed count being <span class="math inline">\(Y \sim Binomial(N, pq)\)</span>. This is the exact simulation that we need when we want to make sure that an <em>estimator</em> can estimate the <em>model</em> parameters (<code>lambda</code> and <code>prob</code> here). But such probabilistic simulations are not very useful when we are interested how well the <em>model</em> captures important aspects of <em>reality</em>.</p>
<p>Going back to the Poisson–Binomial example, <code>N</code> would be a result of all the factors influencing bird abundance, such as geographical location, season, habitat suitability, number of conspecifics, competitors, or predators. <code>Y</code> however would largely depend on how the birds behave depending on timing, or how an observer might detect or miss the different individuals, or count the same individual twice, etc.</p>
<p>Therefore the package has layers, that by default are <em>conditionally independent</em> of each other. This design decision is meant to facilitate the comparison of certain settings while keeping all the underlying realizations identical, thus helping to pinpoint effects without the extra variability introduced by all the other effects.</p>
<p>The conditionally independent <em>layers</em> of a <strong>bSims</strong> realization are the following, with the corresponding function:</p>
<ol style="list-style-type: decimal">
<li>landscape (<code>bsims_init</code>),</li>
<li>population (<code>bsims_populate</code>),</li>
<li>behavior with movement and vocalization events (<code>bsims_animate</code>),</li>
<li>the physical side of the observation process (<code>bsims_detect</code>), and</li>
<li>the human aspect of the observation process (<code>bsims_transcribe</code>).</li>
</ol>
<p>See this example as a sneak peek that we’ll explain in the following subsections:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">bSims</span>)
<span class="co">#&gt; Loading required package: intrval</span>
<span class="co">#&gt; Loading required package: mefa4</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; mefa4 0.3-7   2020-02-28</span>
<span class="co">#&gt; Loading required package: MASS</span>
<span class="co">#&gt; Loading required package: deldir</span>
<span class="co">#&gt; deldir 0.1-25</span>
<span class="co">#&gt; bSims 0.2-2   2019-12-17      woonk-a-chunk</span>

<span class="no">phi</span> <span class="kw">&lt;-</span> <span class="fl">0.5</span>                 <span class="co"># singing rate</span>
<span class="no">tau</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fl">3</span>                 <span class="co"># detection distances by strata</span>
<span class="no">tbr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span>)         <span class="co"># time intervals</span>
<span class="no">rbr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>)      <span class="co"># count radii</span>

<span class="no">l</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_init</a></span>(<span class="fl">10</span>,        <span class="co"># landscape</span>
  <span class="kw">road</span><span class="kw">=</span><span class="fl">0.25</span>, <span class="kw">edge</span><span class="kw">=</span><span class="fl">0.5</span>)
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l</span>,     <span class="co"># population</span>
  <span class="kw">density</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>))
<span class="no">e</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_animate</a></span>(<span class="no">p</span>,      <span class="co"># events</span>
  <span class="kw">vocal_rate</span><span class="kw">=</span><span class="no">phi</span>,
  <span class="kw">move_rate</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">movement</span><span class="kw">=</span><span class="fl">0.2</span>)
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_detect</a></span>(<span class="no">e</span>,       <span class="co"># detections</span>
  <span class="kw">tau</span><span class="kw">=</span><span class="no">tau</span>)
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_transcribe</a></span>(<span class="no">d</span>,   <span class="co"># transcription</span>
  <span class="kw">tint</span><span class="kw">=</span><span class="no">tbr</span>, <span class="kw">rint</span><span class="kw">=</span><span class="no">rbr</span>)

<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_table</a></span>(<span class="no">x</span>) <span class="co"># removal table</span>
<span class="co">#&gt;          0-3min 3-5min 5-10min</span>
<span class="co">#&gt; 0-50m         0      0       0</span>
<span class="co">#&gt; 50-100m       0      0       0</span>
<span class="co">#&gt; 100-150m      0      0       0</span>

<span class="no">op</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">3</span>), <span class="kw">cex.main</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l</span>, <span class="kw">main</span><span class="kw">=</span><span class="st">"Initialize"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">p</span>, <span class="kw">main</span><span class="kw">=</span><span class="st">"Populate"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">e</span>, <span class="kw">main</span><span class="kw">=</span><span class="st">"Animate"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">d</span>, <span class="kw">main</span><span class="kw">=</span><span class="st">"Detect"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">x</span>, <span class="kw">main</span><span class="kw">=</span><span class="st">"Transcribe"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">op</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/intro-1.png" width="100%"></p>
<div id="landscape" class="section level3">
<h3 class="hasAnchor">
<a href="#landscape" class="anchor"></a>Landscape</h3>
<p>The <code>bsims_ini</code> function sets up the geometry of a local landscape. The <code>extent</code> of the landscape determines the edge lengths of a square shaped area. With no argument values passed, the function assumes a homogeneous <em>habitat</em> (H) in a 10 units x 10 units landscape, 1 unit is 100 meters. Having units this way allows easier conversion to ha as area unit that is often used in the North American bird literature. As a result, our landscape has an area of 1 km<span class="math inline">\(^2\)</span>.</p>
<p>The <code>road</code> argument defines the half-width of the road that is placed in a vertical position. The <code>edge</code> argument defines the width of the edge stratum on both sides of the road. Habitat (H), edge (E), and road (R) defines the 3 strata that we refer to by their initials (H for no stratification, HER for all 3 strata present).</p>
<p>The origin of the Cartesian coordinate system inside the landscape is centered at the middle of the square. The <code>offset</code> argument allows the road and edge strata to be shifted to the left (negative values) or to the right (positive values) of the horizontal axis. This makes it possible to create landscapes with only two strata. The <code>bsims_init</code> function returns a landscape object (with class ‘bsims_landscape’).</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r">(<span class="no">l1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_init</a></span>(<span class="kw">extent</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">road</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">edge</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">offset</span> <span class="kw">=</span> <span class="fl">0</span>))
<span class="co">#&gt; bSims landscape</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: H</span>
(<span class="no">l2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_init</a></span>(<span class="kw">extent</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">road</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">edge</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">offset</span> <span class="kw">=</span> <span class="fl">0</span>))
<span class="co">#&gt; bSims landscape</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: HR</span>
(<span class="no">l3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_init</a></span>(<span class="kw">extent</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">road</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">edge</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">offset</span> <span class="kw">=</span> <span class="fl">2</span>))
<span class="co">#&gt; bSims landscape</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: HER</span>
(<span class="no">l4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_init</a></span>(<span class="kw">extent</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">road</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">edge</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">offset</span> <span class="kw">=</span> <span class="fl">5</span>))
<span class="co">#&gt; bSims landscape</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: HE</span>

<span class="no">op</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l1</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Habitat"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l2</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Habitat &amp; road"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>, <span class="fl">5</span>), <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l3</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Habitat, edge, road + offset"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">20</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>, <span class="fl">5</span>), <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">l4</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"2 habitats"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">20</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>, <span class="fl">5</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>, <span class="fl">5</span>), <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/landscape-1.png" width="100%"></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">op</span>)</pre></body></html></div>
</div>
<div id="population" class="section level3">
<h3 class="hasAnchor">
<a href="#population" class="anchor"></a>Population</h3>
<p>The <code>bsims_populate</code> function <em>populates</em> the landscape we created by the <code>bsims_init</code> function, which is the first argument we have to pass to <code>bsims_populate</code>. The function returns a population object (with class ‘bsims_population’). The most important argument that controls how many individuals will inhabit our landscape is <code>density</code> that defines the expected value of individuals per unit area (1 ha). By default, <code>density = 1</code> (<span class="math inline">\(D=1\)</span>) and we have 100 ha in the landscape (<span class="math inline">\(A=100\)</span>) which translates into 100 individuals on average (<span class="math inline">\(E[N]=\lambda=AD\)</span>). The actual number of individuals in the landscape might deviate from this expectation, because <span class="math inline">\(N\)</span> is a random variable (<span class="math inline">\(N \sim f(\lambda)\)</span>). The <code>abund_fun</code> argument controls this relationship between the expected (<span class="math inline">\(\lambda\)</span>) and realized abundance (<span class="math inline">\(N\)</span>). The default is a Poisson distribution:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l1</span>)
<span class="co">#&gt; bSims population</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: H</span>
<span class="co">#&gt;   total abundance: 105</span></pre></body></html></div>
<p>Changing <code>abund_fun</code> can be useful to make abundance constant or allow under or overdispersion, e.g.:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(<span class="fl">100</span>, <span class="fl">100</span>)) <span class="co"># Poisson variation</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   80.00   93.00  100.00   99.54  106.00  125.00</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw pkg">MASS</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/rnegbin.html">rnegbin</a></span>(<span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">0.8</span>)) <span class="co"># NegBin variation</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;    0.00   29.00   70.50   92.91  128.00  504.00</span>
<span class="no">negbin</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">lambda</span>, <span class="no">...</span>) <span class="kw pkg">MASS</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/rnegbin.html">rnegbin</a></span>(<span class="fl">1</span>, <span class="no">lambda</span>, <span class="no">...</span>)
<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l1</span>, <span class="kw">abund_fun</span> <span class="kw">=</span> <span class="no">negbin</span>, <span class="kw">theta</span> <span class="kw">=</span> <span class="fl">0.8</span>)
<span class="co">#&gt; bSims population</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: H</span>
<span class="co">#&gt;   total abundance: 131</span>
<span class="co">## constant abundance</span>
<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l1</span>, <span class="kw">abund_fun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">lambda</span>, <span class="no">...</span>) <span class="no">lambda</span>)
<span class="co">#&gt; bSims population</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: H</span>
<span class="co">#&gt;   total abundance: 100</span></pre></body></html></div>
<p>Once we determine how many individuals will populate the landscape, we have control over the spatial arrangement of the nest location for each individual. The default is a homogeneous Poisson point process (complete spatial randomness). Deviations from this can be controlled by the <code>xy_fun</code>. This function takes distance as its only argument and returns a numeric value between 0 and 1. A function <code>function(d) reurn(1)</code> would be equivalent with the Poisson process, meaning that every new random location is accepted with probability 1 irrespective of the distance between the new location and the previously generated point locations in the landscape. When this function varies with distance, it leads to a non-homogeneous point process via this accept-reject algorithm. The other arguments (<code>margin</code>, <code>maxit</code>, <code>fail</code>) are passed to the underlying <code>accepreject</code> function to remove edge effects and handle high rejection rates.</p>
<p>In the next example, we fix the abundance to be constant (i.e. not a random variable, <span class="math inline">\(N=\lambda\)</span>) and different spatial point processes:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">D</span> <span class="kw">&lt;-</span> <span class="fl">0.5</span>
<span class="no">f_abund</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">lambda</span>, <span class="no">...</span>) <span class="no">lambda</span>

<span class="co">## systematic</span>
<span class="no">f_syst</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">d</span>)
  (<span class="fl">1</span>-<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">d</span>^<span class="fl">2</span>/<span class="fl">1</span>^<span class="fl">2</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span>(<span class="no">d</span>, <span class="fl">2</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">2</span>-<span class="fl">1</span>),<span class="fl">2</span>)) / <span class="fl">2</span>
<span class="co">## clustered</span>
<span class="no">f_clust</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">d</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">d</span>^<span class="fl">2</span>/<span class="fl">1</span>^<span class="fl">2</span>) + <span class="fl">0.5</span>*(<span class="fl">1</span>-<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">d</span>^<span class="fl">2</span>/<span class="fl">4</span>^<span class="fl">2</span>))

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l1</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>, <span class="kw">abund_fun</span> <span class="kw">=</span> <span class="no">f_abund</span>)
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l1</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>, <span class="kw">abund_fun</span> <span class="kw">=</span> <span class="no">f_abund</span>, <span class="kw">xy_fun</span> <span class="kw">=</span> <span class="no">f_syst</span>)
<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l1</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>, <span class="kw">abund_fun</span> <span class="kw">=</span> <span class="no">f_abund</span>, <span class="kw">xy_fun</span> <span class="kw">=</span> <span class="no">f_clust</span>)

<span class="no">distance</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">0.01</span>)
<span class="no">op</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">distance</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">distance</span>)), <span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>, <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>),
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"random"</span>, <span class="kw">ylab</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu">f</span>(<span class="no">d</span>)), <span class="kw">col</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">p1</span>)

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">distance</span>, <span class="fu">f_syst</span>(<span class="no">distance</span>), <span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>, <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>),
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"systematic"</span>, <span class="kw">ylab</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu">f</span>(<span class="no">d</span>)), <span class="kw">col</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">p2</span>)

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">distance</span>, <span class="fu">f_clust</span>(<span class="no">distance</span>), <span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>, <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>),
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"clustered"</span>, <span class="kw">ylab</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu">f</span>(<span class="no">d</span>)), <span class="kw">col</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">p3</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/pop-xy-1.png" width="576"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">op</span>)</pre></body></html></div>
<p>The <code>get_nests</code> function extracts the nest locations. <code>get_abundance</code> and <code>get_density</code> gives the total abundance (<span class="math inline">\(N\)</span>) and density (<span class="math inline">\(D=N/A\)</span>, where <span class="math inline">\(A\)</span> is <code>extent^2</code>) in the landscape, respectively.</p>
<p>If the landscape is stratified, that has no effect on density unless we specify different values through the <code>density</code> argument as a vector of length 3 referring to the HER strata:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">D</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">H</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">E</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">R</span> <span class="kw">=</span> <span class="fl">0</span>)

<span class="no">op</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l1</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Habitat"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l2</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Habitat &amp; road"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l3</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Habitat, edge, road + offset"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l4</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"2 habitats"</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/pop-dens-1.png" width="100%"></p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">op</span>)</pre></body></html></div>
</div>
<div id="behavior" class="section level3">
<h3 class="hasAnchor">
<a href="#behavior" class="anchor"></a>Behavior</h3>
<p>The <code>bsims_animate</code> function <em>animates</em> the population created by the <code>bsims_populate</code> function. <code>bsims_animate</code> returns an events object (with class ‘bsims_events’). The most important arguments are governing the <code>duration</code> of the simulation in minutes, the vocalization (<code>vocal_rate</code>), and the movement (<code>move_rate</code>) rates as average number of events per minute.</p>
<p>We can describe these behavioral events using survival modeling terminology. Event time (<span class="math inline">\(T\)</span>) is a continuous random variable. In the simplest case, its probability density function is the Exponential distribution: <span class="math inline">\(f(t)=\phi e^{-t\phi}\)</span>. The corresponding cumulative distribution function is: <span class="math inline">\(F(t)=\int_{0}^{t} f(t)dt=1-e^{-t\phi}=p_t\)</span>, giving the probability that the event has occurred by duration <span class="math inline">\(t\)</span>. The parameter <span class="math inline">\(\phi\)</span> is the rate of the Exponential distribution with mean <span class="math inline">\(1/\phi\)</span> and variance <span class="math inline">\(1/\phi^2\)</span>.</p>
<p>In survival models, the complement of <span class="math inline">\(F(t)\)</span> is called the <em>survival function</em> (<span class="math inline">\(S(t)=1-F(t)\)</span>, <span class="math inline">\(S(0)=1\)</span>), which gives the probability that the event has not occurred by duration <span class="math inline">\(t\)</span>. The <em>hazard function</em> (<span class="math inline">\(\lambda(t)=f(t)/S(t)\)</span>) defines the instantaneous rate of occurrence of the event (risk, the density of events at <span class="math inline">\(t\)</span> divided by the probability of surviving). The cumulative hazard (cumulative risk) is the sum of the risks between duration 0 and <span class="math inline">\(t\)</span> (<span class="math inline">\(\Lambda(t)=\int_{0}^{t} \lambda(t)dt\)</span>).</p>
<p>The simplest survival distribution assumes constant risk over time (<span class="math inline">\(\lambda(t)=\phi\)</span>), which corresponds to the Exponential distribution. The Exponential distribution also happens to describe the lengths of the inter-event times in a homogeneous Poisson process (events are independent, it is a ‘memory-less’ process).</p>
<p><code>bsims_animate</code> uses independent Exponential distributions with rates <code>vocal_rate</code> and <code>move_rate</code> to simulate vocalization and movement events, respectively. The <code>get_events</code> function extracts the events as a data frame with columns describing the location (<code>x</code>, <code>y</code>) and time (<code>t</code>) of the events (<code>v</code> is 1 for vocalizations and 0 otherwise) for each individual (<code>i</code> gives the individual identifier that links individuals to the nest locations)</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">l</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_init</a></span>()
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="fl">0.5</span>)
<span class="no">e1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_animate</a></span>(<span class="no">p</span>, <span class="kw">vocal_rate</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_events</a></span>(<span class="no">e1</span>))
<span class="co">#&gt;            x          y           t v  i</span>
<span class="co">#&gt; 1 -3.1574571 -1.9481752 0.001580241 1 20</span>
<span class="co">#&gt; 2  3.2556064 -0.5015956 0.009923855 1 37</span>
<span class="co">#&gt; 3 -2.7010511 -0.2211221 0.010058172 1 23</span>
<span class="co">#&gt; 4  3.4310968  2.1861406 0.048788271 1 28</span>
<span class="co">#&gt; 5  0.9002583 -1.3580481 0.072173809 1 24</span>
<span class="co">#&gt; 6  3.6392110  0.4004323 0.094942885 1 42</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_events</a></span>(<span class="no">e1</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span>((<span class="fl">1</span>-<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="fl">1</span>*<span class="no">x</span>)) * <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_abundance</a></span>(<span class="no">e1</span>), <span class="kw">col</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">add</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/beh-events-1.png" width="576"></p>
<p>There are no movement related events when <code>move_rate = 0</code>, the individuals are always located at the nest, i.e. there is no within territory movement. If we increase the movement rate, we also have to increase the value of <code>movement</code>, that is the standard deviation of bivariate Normal kernels centered around each nest location. This kernel is used to simulate new locations for the movement events.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">e2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_animate</a></span>(<span class="no">p</span>, <span class="kw">move_rate</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">movement</span> <span class="kw">=</span> <span class="fl">0.25</span>)

<span class="no">op</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">e1</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Closure"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">e2</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Movement"</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/beh-move-1.png" width="100%"></p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">op</span>)</pre></body></html></div>
<p>Individuals in the landscape might have different vocalization rates depending on, e.g., breeding status. Such heterogeneity can be added to the simulations as a finite mixture: <code>vocal_rate</code> and <code>move_rate</code> can be supplied as a vector, each element giving the rate for the groups. The <code>mixture</code> argument is then used to specify the mixture proportions.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">e3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_animate</a></span>(<span class="no">p</span>,
  <span class="kw">vocal_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">25</span>, <span class="fl">1</span>), <span class="kw">mixture</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.33</span>, <span class="fl">0.67</span>))

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_events</a></span>(<span class="no">e3</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span>((<span class="fl">1</span>-<span class="fl">0.67</span>*<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="fl">1</span>*<span class="no">x</span>)) * <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_abundance</a></span>(<span class="no">e3</span>), <span class="kw">col</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">add</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/beh-mix-1.png" width="576"></p>
<p>Vocal and movement rates (and corresponding kernel standard deviations) can be defined four different ways:</p>
<ul>
<li>a single number: constant behavior patterns, no groups,</li>
<li>a vector of length <code><a href="https://rdrr.io/r/base/length.html">length(mixture)</a></code>: behavior based finite mixture groups,</li>
<li>a vector of length 3 with <code>mixture = 1</code>: mixtures correspond to HER strata,</li>
<li>or a matrix of dimension 3 <span class="math inline">\(\times\)</span> <code><a href="https://rdrr.io/r/base/length.html">length(mixture)</a></code>: HER strata <span class="math inline">\(\times\)</span> number of behavior based groups.</li>
</ul>
<p>Strata based groups are tracked by column <code>s</code>, behavior based groups are tracked as the column <code>g</code> in the output of <code>get_nests</code>.</p>
<p>Here is how different territory sizes can be achieved in a two-habitat landscape:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_animate</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l4</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>),
  <span class="kw">move_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1</span>), <span class="kw">movement</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>),
  <span class="kw">mixture</span> <span class="kw">=</span> <span class="fl">1</span>), <span class="kw">main</span><span class="kw">=</span><span class="st">"Strata based mixtures"</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/beh-move2-1.png" width="480"></p>
<p>Stratum related behavior groups depend on the nest location. Sometimes it makes sense to restrict movement even further, i.e. individuals do not land in certain strata (but can cross a stratum if <code>movement</code> is large enough). For example, we can restrict movement into the road stratum (this requires density to be 0 in that stratum):</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">op</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_animate</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l2</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>),
  <span class="kw">move_rate</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">movement</span> <span class="kw">=</span> <span class="fl">0.3</span>,
  <span class="kw">avoid</span> <span class="kw">=</span> <span class="st">"none"</span>), <span class="kw">main</span><span class="kw">=</span><span class="st">"Movement not restricted"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_animate</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l2</span>, <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>),
  <span class="kw">move_rate</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">movement</span> <span class="kw">=</span> <span class="fl">0.3</span>,
  <span class="kw">avoid</span> <span class="kw">=</span> <span class="st">"R"</span>), <span class="kw">main</span><span class="kw">=</span><span class="st">"Movement restricted"</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/beh-move3-1.png" width="100%"></p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">op</span>)</pre></body></html></div>
<p>Another way to restrict the movement of individuals is to prevent the overlap based on a Voronoi tessellation around the nest locations. Note: we are using the update method here to update the <code>allow_overlap</code> argument of the previous call, and the plot method from the <strong>deldir</strong> package used for tessellation.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">e4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(<span class="no">e2</span>, <span class="kw">allow_overlap</span><span class="kw">=</span><span class="fl">FALSE</span>)

<span class="no">op</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">e2</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Overlap"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">e2</span>$<span class="no">tess</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">wlines</span> <span class="kw">=</span> <span class="st">"tess"</span>, <span class="kw">wpoints</span> <span class="kw">=</span> <span class="st">"none"</span>,
  <span class="kw">col</span> <span class="kw">=</span> <span class="st">"grey"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">e4</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"No overlap"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">e4</span>$<span class="no">tess</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">wlines</span> <span class="kw">=</span> <span class="st">"tess"</span>, <span class="kw">wpoints</span> <span class="kw">=</span> <span class="st">"none"</span>,
  <span class="kw">col</span> <span class="kw">=</span> <span class="st">"grey"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/beh-move4-1.png" width="100%"></p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">op</span>)</pre></body></html></div>
<p>We haven’t mentioned the <code>initial_location</code> argument yet. This allows to override this whole layer and make all individuals fully available for the other layers applied on top. I.e. it is possible to study the observation process without any behavioral interference when <code>initial_location = TRUE</code>.</p>
</div>
<div id="detection" class="section level3">
<h3 class="hasAnchor">
<a href="#detection" class="anchor"></a>Detection</h3>
<p>The <code>bsims_detect</code> function <em>detects</em> the events created by the <code>bsims_animate</code> function. <code>bsims_detect</code> returns a detections object (with class ‘bsims_detections’). The argument <code>xy</code> defines the location of the observer in the landscape. By default, it is in the middle, but can be moved anywhere within the bounds of the landscape.</p>
<p><code>tau</code> is the parameter of the distance function <code>dist_fun</code>. The distance function (<span class="math inline">\(g(d)\)</span>) describes the monotonic relationship of how the probability of detecting an individual decreases with distance (<span class="math inline">\(d\)</span>). Detection probability at 0 distance is 1.</p>
<p>The most commonly used distance function is the Half-Normal. This is a one-parameter function (<span class="math inline">\(g(d) = e^{-(d/\tau)^2}\)</span>) where probability initially remain high, reflecting an increased chance of detecting individuals closer to the observer (<span class="math inline">\(\tau^2\)</span> is variance of the unfolded Normal distribution, <span class="math inline">\(\tau^2/2\)</span> is the variance of the Half-Normal distribution). Run <code><a href="https://rdrr.io/pkg/bSims/man/run_app.html">run_app("distfunH")</a></code> to launch a <strong>shiny</strong> app to explore different distance functions, like Hazard rate.</p>
<p>The distance function must take distance <code>d</code> as its 1st argument and the parameter <code>tau</code> is its second argument (other arguments can be passed as well). E.g. the default is <code>function(d, tau) exp(-(d/tau)^2)</code>, or the Hazard rate function can be written as <code>function(d, tau, b=2) 1-exp(-(d/tau)^-b)</code>.</p>
<p>Individuals are detected via auditory and visual cues that are related to vocalization or movement events, respectively. The <code>event_type</code> argument determines what kinds of events can be detected, vocalization, movement, or both. Detection here refers to the Bernoulli process with probability <span class="math inline">\(g(d)\)</span> given the actual linear distance between the individual at that time and the observer. The <code>get_detections</code> function extracts the events that are detected, the column <code>d</code> contains the distances (in 100 m units).</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r">(<span class="no">d1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_detect</a></span>(<span class="no">e2</span>, <span class="kw">tau</span> <span class="kw">=</span> <span class="fl">2</span>))
<span class="co">#&gt; bSims detections</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: H</span>
<span class="co">#&gt;   total abundance: 47</span>
<span class="co">#&gt;   duration: 10 min</span>
<span class="co">#&gt;   detected: 19 heard</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_detections</a></span>(<span class="no">d1</span>))
<span class="co">#&gt;              x          y         t v         d  i  j</span>
<span class="co">#&gt; 36  0.56654502 -2.1103945 0.3114306 1 2.1851175 41 41</span>
<span class="co">#&gt; 50 -4.03249134  1.4051888 0.4228829 1 4.2703094 10 10</span>
<span class="co">#&gt; 71  1.07678536 -1.8766084 0.6886996 1 2.1635910 46 46</span>
<span class="co">#&gt; 72 -1.04974751 -0.2095754 0.6892619 1 1.0704633 11 11</span>
<span class="co">#&gt; 82  0.90025832 -1.3580481 0.7595139 1 1.6293433 24 24</span>
<span class="co">#&gt; 86 -0.04955808  0.9531316 0.8354224 1 0.9544191 15 15</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">d1</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/det-1.png" width="480"></p>
<p>The <code>tau</code> argument can be a vector of length 3, referring to detection distances in the HER strata. When the landscape is stratified, and detection distances are different among the strata the <code>bsims_detect</code> function uses a segmented attenuation model along the linear distance between the bird and the observer. The <code><a href="https://rdrr.io/pkg/bSims/man/run_app.html">run_app("distfunHER")</a></code> <strong>shiny</strong> explores the segmented attenuation.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">tau</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>)
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0.01</span>)
<span class="no">dist_fun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">d</span>, <span class="no">tau</span>) <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-(<span class="no">d</span>/<span class="no">tau</span>)^<span class="fl">2</span>) <span class="co"># half normal</span>
<span class="co">#dist_fun &lt;- function(d, tau) exp(-d/tau) # exponential</span>
<span class="co">#dist_fun &lt;- function(d, tau) 1-exp(-(d/tau)^-2) # hazard rate</span>

<span class="no">b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span>) <span class="co">#  boundaries</span>

<span class="no">op</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">d</span>, <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>[<span class="fl">1</span>], <span class="no">dist_fun</span>), <span class="kw">type</span><span class="kw">=</span><span class="st">"n"</span>,
  <span class="kw">ylab</span><span class="kw">=</span><span class="st">"g(d)"</span>, <span class="kw">xlab</span><span class="kw">=</span><span class="st">"d (100 m)"</span>, <span class="kw">axes</span><span class="kw">=</span><span class="fl">FALSE</span>,
  <span class="kw">main</span><span class="kw">=</span><span class="st">"Sound travels from left to right"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">2</span>)
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">b</span>)+<span class="fl">1</span>)) {
  <span class="no">x1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">b</span>, <span class="fl">4</span>)[<span class="no">i</span>]
  <span class="no">x2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">b</span>, <span class="fl">4</span>)[<span class="no">i</span>+<span class="fl">1</span>]
  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">b</span>, <span class="fl">4</span>)[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">i</span>, <span class="no">i</span>, <span class="no">i</span>+<span class="fl">1</span>, <span class="no">i</span>+<span class="fl">1</span>)], <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>),
    <span class="kw">border</span><span class="kw">=</span><span class="fl">NA</span>,
    <span class="kw">col</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkolivegreen1"</span>, <span class="st">"burlywood1"</span>, <span class="st">"lightgrey"</span>,
    <span class="st">"burlywood1"</span>, <span class="st">"darkolivegreen1"</span>)[<span class="no">i</span>])
}
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">d</span>, <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>[<span class="fl">1</span>], <span class="no">dist_fun</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">d</span>, <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>[<span class="fl">2</span>], <span class="no">dist_fun</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">d</span>, <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>[<span class="fl">3</span>], <span class="no">dist_fun</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">d</span>, <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>, <span class="no">dist_fun</span>, <span class="no">b</span>), <span class="kw">col</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">3</span>)

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">d</span>), <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>[<span class="fl">1</span>], <span class="no">dist_fun</span>), <span class="kw">type</span><span class="kw">=</span><span class="st">"n"</span>,
  <span class="kw">ylab</span><span class="kw">=</span><span class="st">"g(d)"</span>, <span class="kw">xlab</span><span class="kw">=</span><span class="st">"d (100 m)"</span>, <span class="kw">axes</span><span class="kw">=</span><span class="fl">FALSE</span>,
  <span class="kw">main</span><span class="kw">=</span><span class="st">"Sound travels from right to left"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">2</span>)
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">b</span>)+<span class="fl">1</span>)) {
  <span class="no">x1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">b</span>, <span class="fl">4</span>)[<span class="no">i</span>]
  <span class="no">x2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">b</span>, <span class="fl">4</span>)[<span class="no">i</span>+<span class="fl">1</span>]
  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">b</span>, <span class="fl">4</span>)[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">i</span>, <span class="no">i</span>, <span class="no">i</span>+<span class="fl">1</span>, <span class="no">i</span>+<span class="fl">1</span>)], <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>),
    <span class="kw">border</span><span class="kw">=</span><span class="fl">NA</span>,
    <span class="kw">col</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkolivegreen1"</span>, <span class="st">"burlywood1"</span>, <span class="st">"lightgrey"</span>,
    <span class="st">"burlywood1"</span>, <span class="st">"darkolivegreen1"</span>)[<span class="no">i</span>])
}
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">d</span>), <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>[<span class="fl">1</span>], <span class="no">dist_fun</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">d</span>), <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>[<span class="fl">2</span>], <span class="no">dist_fun</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">d</span>), <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>[<span class="fl">3</span>], <span class="no">dist_fun</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">d</span>), <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/dist_fun2.html">dist_fun2</a></span>(<span class="no">d</span>, <span class="no">tau</span>, <span class="no">dist_fun</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="fl">4</span>-<span class="no">b</span>)), <span class="kw">col</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/segm-1.png" width="576"></p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">op</span>)</pre></body></html></div>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">e5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_animate</a></span>(
  <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(
    <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_init</a></span>(<span class="kw">road</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">edge</span> <span class="kw">=</span> <span class="fl">0.4</span>), <span class="kw">density</span> <span class="kw">=</span> <span class="no">D</span>),
  <span class="kw">move_rate</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">movement</span> <span class="kw">=</span> <span class="fl">0.2</span>)
(<span class="no">d2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_detect</a></span>(<span class="no">e5</span>, <span class="kw">tau</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>), <span class="kw">event_type</span> <span class="kw">=</span> <span class="st">"both"</span>))
<span class="co">#&gt; bSims detections</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: HER</span>
<span class="co">#&gt;   total abundance: 192</span>
<span class="co">#&gt;   duration: 10 min</span>
<span class="co">#&gt;   detected: 48 seen/heard</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_detections</a></span>(<span class="no">d2</span>))
<span class="co">#&gt;              x          y          t v        d   i   j</span>
<span class="co">#&gt; 25   0.7077971 -1.3834329 0.04585463 1 1.553983 148 148</span>
<span class="co">#&gt; 31  -1.6289983 -0.2969315 0.06989294 1 1.655839  89  89</span>
<span class="co">#&gt; 40   0.9776243 -0.8567035 0.09464514 0 1.299881 136 136</span>
<span class="co">#&gt; 90   1.2324568  0.3251513 0.23212265 1 1.274627 161 161</span>
<span class="co">#&gt; 110 -0.7048471  2.9448793 0.28508227 0 3.028056  91  91</span>
<span class="co">#&gt; 118  0.2906563 -0.3053235 0.30325080 0 0.421549 100 100</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">d2</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/det2-1.png" width="480"></p>
</div>
<div id="transcription" class="section level3">
<h3 class="hasAnchor">
<a href="#transcription" class="anchor"></a>Transcription</h3>
<p>The last layer of simulation is the <code>bsims_transcribe</code> function that <em>transcribes</em> the detections created by the <code>bsims_detect</code> function. <code>bsims_transcribe</code> returns a detections object (with class ‘bsims_transcript’). This layer refers to the process of the observer assigning detected individuals to time and distance categories. The <code>tint</code> argument is a vector containing the endpoints of the time intervals within the total duration in minutes. <code>rint</code> defines the distance bands in 100 m units, the maximum can be infinite referring to an unlimited distance count.</p>
<p>The <code>error</code> argument refers to distance estimation error. This does not impact the actual distance between the bird and the observer, but it can lead to misclassification of the distance interval where the individual is assigned. The argument is the log scale standard deviation for lognormally distributed random variable representing this error.</p>
<p>The <code>condition</code> argument defines which events will be transcribed: <code>"event1"</code> refers to the 1st event (detected or not), <code>"det1"</code> refers to the 1st detection, <code>"alldet"</code> means all detections (possibly counting the same individual multiple times). The <code>event_type</code> argument can be redefined here, too.</p>
<p><code>perception</code> creates individual identifiers as perceived by the observer. The argument defines the perceived number of individuals relative to the actual number of individuals. It can be a non-negative number (&lt;1 values lead to under counting, &gt;1 values lead to over counting), or <code>NULL</code> (observer correctly identifies all individuals). The algorithm uses the event based locations in a hierarchical clustering. The dendrogram is cut at a height corresponding to specified <code>perception</code> level and group membership is used as individual identifier.</p>
<p>The <code>bsims_transcribe</code> eventually prepares a ‘removal’ table that counts the new individuals in each time/distance interval. This table is used in removal and distance sampling. The ‘visits’ table counts individuals by time and distance interval, but counting restarts in every time interval (i.e. not just the new individuals are counted). The plot method overlays the distance bands and a representation of the time intervals.</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_transcribe</a></span>(<span class="no">d1</span>,
  <span class="kw">tint</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span>),
  <span class="kw">rint</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">Inf</span>))
<span class="no">x</span>
<span class="co">#&gt; bSims transcript</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: H</span>
<span class="co">#&gt;   total abundance: 47</span>
<span class="co">#&gt;   duration: 10 min</span>
<span class="co">#&gt;   detected: 19 heard</span>
<span class="co">#&gt;   1st event detected by breaks:</span>
<span class="co">#&gt;     [0, 2, 4, 6, 8, 10 min]</span>
<span class="co">#&gt;     [0, 50, 100, 150, Inf m]</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">x</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/trans-1.png" width="576"></p>
<div class="sourceCode" id="cb26"><html><body><pre class="r">
<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_table</a></span>(<span class="no">x</span>, <span class="st">"removal"</span>)
<span class="co">#&gt;          0-2min 2-4min 4-6min 6-8min 8-10min</span>
<span class="co">#&gt; 0-50m         0      0      1      0       0</span>
<span class="co">#&gt; 50-100m       0      0      0      0       0</span>
<span class="co">#&gt; 100-150m      0      0      0      0       0</span>
<span class="co">#&gt; 150+m         7      1      0      0       0</span>
<span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_table</a></span>(<span class="no">x</span>, <span class="st">"visits"</span>)
<span class="co">#&gt;          0-2min 2-4min 4-6min 6-8min 8-10min</span>
<span class="co">#&gt; 0-50m         0      0      1      0       0</span>
<span class="co">#&gt; 50-100m       0      0      1      0       1</span>
<span class="co">#&gt; 100-150m      0      1      1      1       1</span>
<span class="co">#&gt; 150+m         7      5      2      2       6</span></pre></body></html></div>
</div>
</div>
<div id="statistical-validity-of-the-simulations" class="section level2">
<h2 class="hasAnchor">
<a href="#statistical-validity-of-the-simulations" class="anchor"></a>Statistical validity of the simulations</h2>
<p>We can test the validity of the simulations when all of the assumptions are met (that is the default) in the homogeneous habitat case. We set singing rate (<code>phi</code>), detection distance (<code>tau</code>), and density (<code>Den</code>) for the simulations. Density is in this case unrealistically high, because we are not using replication only a single landscape. This will help with the estimation.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">phi</span> <span class="kw">&lt;-</span> <span class="fl">0.5</span> <span class="co"># singing rate</span>
<span class="no">tau</span> <span class="kw">&lt;-</span> <span class="fl">2</span>   <span class="co"># detection distance</span>
<span class="no">Den</span> <span class="kw">&lt;-</span> <span class="fl">10</span>  <span class="co"># density</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)
<span class="no">l</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_init</a></span>()
<span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_populate</a></span>(<span class="no">l</span>, <span class="kw">density</span><span class="kw">=</span><span class="no">Den</span>)
<span class="no">b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_animate</a></span>(<span class="no">a</span>, <span class="kw">vocal_rate</span><span class="kw">=</span><span class="no">phi</span>)
<span class="no">o</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_detect</a></span>(<span class="no">b</span>, <span class="kw">tau</span><span class="kw">=</span><span class="no">tau</span>)

<span class="no">tint</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>)
<span class="no">rint</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span>) <span class="co"># truncated at 200 m</span>
(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_transcribe</a></span>(<span class="no">o</span>, <span class="kw">tint</span><span class="kw">=</span><span class="no">tint</span>, <span class="kw">rint</span><span class="kw">=</span><span class="no">rint</span>))
<span class="co">#&gt; bSims transcript</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: H</span>
<span class="co">#&gt;   total abundance: 1014</span>
<span class="co">#&gt;   duration: 10 min</span>
<span class="co">#&gt;   detected: 259 heard</span>
<span class="co">#&gt;   1st event detected by breaks:</span>
<span class="co">#&gt;     [0, 1, 2, 3, 4, 5 min]</span>
<span class="co">#&gt;     [0, 50, 100, 150, 200 m]</span>
(<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_table</a></span>(<span class="no">x</span>, <span class="st">"removal"</span>)) <span class="co"># binned new individuals</span>
<span class="co">#&gt;          0-1min 1-2min 2-3min 3-4min 4-5min</span>
<span class="co">#&gt; 0-50m         1      3      1      2      0</span>
<span class="co">#&gt; 50-100m       7      3      5      1      1</span>
<span class="co">#&gt; 100-150m     12      2      2      1      2</span>
<span class="co">#&gt; 150-200m     13      8      2      1      1</span>
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(<span class="no">y</span>)
<span class="co">#&gt; 0-1min 1-2min 2-3min 3-4min 4-5min </span>
<span class="co">#&gt;     33     16     10      5      4</span>
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">y</span>)
<span class="co">#&gt;    0-50m  50-100m 100-150m 150-200m </span>
<span class="co">#&gt;        7       17       19       25</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">x</span>)</pre></body></html></div>
<p><img src="intro_files/figure-html/H-1.png" width="480"></p>
<p>We use the <strong>detect</strong> package to fit removal model and distance sampling model to the simulated output. This is handily implemented in the <code>estimate</code> method for the transcription objects. First, we estimate singing rate, effective detection distance, and density based on truncated distance counts:</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">detect</span>)
<span class="co">#&gt; Loading required package: Formula</span>
<span class="co">#&gt; Loading required package: stats4</span>
<span class="co">#&gt; Loading required package: pbapply</span>
<span class="co">#&gt; detect 0.4-2      2018-08-29</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">true</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">phi</span><span class="kw">=</span><span class="no">phi</span>, <span class="kw">tau</span><span class="kw">=</span><span class="no">tau</span>, <span class="kw">D</span><span class="kw">=</span><span class="no">Den</span>),
  <span class="kw">estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/estimate.html">estimate</a></span>(<span class="no">x</span>))
<span class="co">#&gt;     true  estimate</span>
<span class="co">#&gt; phi  0.5 0.5768794</span>
<span class="co">#&gt; tau  2.0 2.2733052</span>
<span class="co">#&gt; D   10.0 8.2330714</span></pre></body></html></div>
<p>Next, we estimate singing rate, effective detection distance, and density based on unlimited distance counts:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">rint</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fl">Inf</span>) <span class="co"># unlimited</span>

(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_transcribe</a></span>(<span class="no">o</span>, <span class="kw">tint</span><span class="kw">=</span><span class="no">tint</span>, <span class="kw">rint</span><span class="kw">=</span><span class="no">rint</span>))
<span class="co">#&gt; bSims transcript</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: H</span>
<span class="co">#&gt;   total abundance: 1014</span>
<span class="co">#&gt;   duration: 10 min</span>
<span class="co">#&gt;   detected: 259 heard</span>
<span class="co">#&gt;   1st event detected by breaks:</span>
<span class="co">#&gt;     [0, 1, 2, 3, 4, 5 min]</span>
<span class="co">#&gt;     [0, 50, 100, 150, 200, Inf m]</span>
(<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/getters.html">get_table</a></span>(<span class="no">x</span>, <span class="st">"removal"</span>)) <span class="co"># binned new individuals</span>
<span class="co">#&gt;          0-1min 1-2min 2-3min 3-4min 4-5min</span>
<span class="co">#&gt; 0-50m         1      3      1      2      0</span>
<span class="co">#&gt; 50-100m       7      3      5      1      1</span>
<span class="co">#&gt; 100-150m     12      2      2      1      2</span>
<span class="co">#&gt; 150-200m     13      8      2      1      1</span>
<span class="co">#&gt; 200+m        15      9      6      6      2</span>
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(<span class="no">y</span>)
<span class="co">#&gt; 0-1min 1-2min 2-3min 3-4min 4-5min </span>
<span class="co">#&gt;     48     25     16     11      6</span>
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">y</span>)
<span class="co">#&gt;    0-50m  50-100m 100-150m 150-200m    200+m </span>
<span class="co">#&gt;        7       17       19       25       38</span>

<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">true</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">phi</span><span class="kw">=</span><span class="no">phi</span>, <span class="kw">tau</span><span class="kw">=</span><span class="no">tau</span>, <span class="kw">D</span><span class="kw">=</span><span class="no">Den</span>),
  <span class="kw">estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/estimate.html">estimate</a></span>(<span class="no">x</span>))
<span class="co">#&gt;     true  estimate</span>
<span class="co">#&gt; phi  0.5 0.5128359</span>
<span class="co">#&gt; tau  2.0 1.9928785</span>
<span class="co">#&gt; D   10.0 9.2041636</span></pre></body></html></div>
<p>Deviations from the assumptions and bias in density estimation can be done by systematically evaluating the simulations settings, which we describe in the next section.</p>
</div>
<div id="simulation-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-workflow" class="anchor"></a>Simulation workflow</h2>
<p>We recommend exploring the simulation settings interactively in the <strong>shiny</strong> apps using <code><a href="https://rdrr.io/pkg/bSims/man/run_app.html">run_app("bsimsH")</a></code> app for the homogeneous habitat case and the <code><a href="https://rdrr.io/pkg/bSims/man/run_app.html">run_app("bsimsHER")</a></code> app for the stratified habitat case. The apps represent the simulation layers as tabs, the last tab presenting the settings that can be copied onto the clipboard and pasted into the R session or code. In simple situations, comparing results from a few different settings might be enough.</p>
<p>Let us consider the following simple comparison: we want to see how much of an effect does roads have when the only effect is that the road stratum is unsuitable. Otherwise there are no behavioral or detectability effects of the road.</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">tint</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span>)
<span class="no">rint</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fl">Inf</span>) <span class="co"># unlimited</span>

<span class="co">## no road</span>
<span class="no">b1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_all</a></span>(
  <span class="kw">road</span> <span class="kw">=</span> <span class="fl">0</span>,
  <span class="kw">density</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>),
  <span class="kw">tint</span> <span class="kw">=</span> <span class="no">tint</span>,
  <span class="kw">rint</span> <span class="kw">=</span> <span class="no">rint</span>)
<span class="co">## road</span>
<span class="no">b2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/bsims_init.html">bsims_all</a></span>(
  <span class="kw">road</span> <span class="kw">=</span> <span class="fl">0.5</span>,
  <span class="kw">density</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>),
  <span class="kw">tint</span> <span class="kw">=</span> <span class="no">tint</span>,
  <span class="kw">rint</span> <span class="kw">=</span> <span class="no">rint</span>)
<span class="no">b1</span>
<span class="co">#&gt; bSims wrapper object with settings:</span>
<span class="co">#&gt;   road   : 0</span>
<span class="co">#&gt;   density: 1, 1, 0</span>
<span class="co">#&gt;   tint   : 2, 4, 6, 8, 10</span>
<span class="co">#&gt;   rint   : 0.5, 1, 1.5, 2, Inf</span>
<span class="no">b2</span>
<span class="co">#&gt; bSims wrapper object with settings:</span>
<span class="co">#&gt;   road   : 0.5</span>
<span class="co">#&gt;   density: 1, 1, 0</span>
<span class="co">#&gt;   tint   : 2, 4, 6, 8, 10</span>
<span class="co">#&gt;   rint   : 0.5, 1, 1.5, 2, Inf</span></pre></body></html></div>
<p>The <code>bsims_all</code> function accepts all the arguments we discussed before for the simulation layers. Unspecified arguments will be taken to be the default value. However, <code>bsims_all</code> does not evaluate these arguments, but it creates a closure with the settings. Realizations can be drawn as:</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">b1</span>$<span class="fu">new</span>()
<span class="co">#&gt; bSims transcript</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: H</span>
<span class="co">#&gt;   total abundance: 75</span>
<span class="co">#&gt;   duration: 10 min</span>
<span class="co">#&gt;   detected: 12 heard</span>
<span class="co">#&gt;   1st event detected by breaks:</span>
<span class="co">#&gt;     [0, 2, 4, 6, 8, 10 min]</span>
<span class="co">#&gt;     [0, 50, 100, 150, 200, Inf m]</span>
<span class="no">b2</span>$<span class="fu">new</span>()
<span class="co">#&gt; bSims transcript</span>
<span class="co">#&gt;   1 km x 1 km</span>
<span class="co">#&gt;   stratification: HR</span>
<span class="co">#&gt;   total abundance: 95</span>
<span class="co">#&gt;   duration: 10 min</span>
<span class="co">#&gt;   detected: 4 heard</span>
<span class="co">#&gt;   1st event detected by breaks:</span>
<span class="co">#&gt;     [0, 2, 4, 6, 8, 10 min]</span>
<span class="co">#&gt;     [0, 50, 100, 150, 200, Inf m]</span></pre></body></html></div>
<p>Run multiple realizations is done as:</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">B</span> <span class="kw">&lt;-</span> <span class="fl">25</span>  <span class="co"># number of runs</span>
<span class="no">bb1</span> <span class="kw">&lt;-</span> <span class="no">b1</span>$<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="no">B</span>)
<span class="no">bb2</span> <span class="kw">&lt;-</span> <span class="no">b2</span>$<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="no">B</span>)</pre></body></html></div>
<p>The replicate function takes an argument for the number of replicates (<code>B</code>) and returns a list of transcript objects with <span class="math inline">\(B\)</span> elements. The <code>cl</code> argument can be used to parallelize the work, it can be a numeric value on Unix/Linux/OSX, or a cluster object on any OS. The <code>recover = TRUE</code> argument allows to run simulations with error catching.</p>
<p>Simulated objects returned by <code>bsims_all</code> will contain different realizations and all the conditionally independent layers. Use a customized layered approach if former layers are meant to be kept identical across runs.</p>
<p>In more complex situations the <strong>shiny</strong> apps will help identifying corner cases that are used to define a gradient of settings for single or multiple simulation options. Let us consider the following scenario: we would like to evaluate how the estimates are changing with increasing road width. We will use the <code>expand_list</code> function which creates a list from all combinations of the supplied inputs. Note that we need to wrap vectors inside <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> to avoid interpreting those as values to iterate over.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">s</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/expand_list.html">expand_list</a></span>(
  <span class="kw">road</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>),
  <span class="kw">density</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>)),
  <span class="kw">tint</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">tint</span>),
  <span class="kw">rint</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">rint</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">s</span>)
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ :List of 4</span>
<span class="co">#&gt;   ..$ road   : num 0</span>
<span class="co">#&gt;   ..$ density: num [1:3] 1 1 0</span>
<span class="co">#&gt;   ..$ tint   : num [1:5] 2 4 6 8 10</span>
<span class="co">#&gt;   ..$ rint   : num [1:5] 0.5 1 1.5 2 Inf</span>
<span class="co">#&gt;  $ :List of 4</span>
<span class="co">#&gt;   ..$ road   : num 0.5</span>
<span class="co">#&gt;   ..$ density: num [1:3] 1 1 0</span>
<span class="co">#&gt;   ..$ tint   : num [1:5] 2 4 6 8 10</span>
<span class="co">#&gt;   ..$ rint   : num [1:5] 0.5 1 1.5 2 Inf</span>
<span class="co">#&gt;  $ :List of 4</span>
<span class="co">#&gt;   ..$ road   : num 1</span>
<span class="co">#&gt;   ..$ density: num [1:3] 1 1 0</span>
<span class="co">#&gt;   ..$ tint   : num [1:5] 2 4 6 8 10</span>
<span class="co">#&gt;   ..$ rint   : num [1:5] 0.5 1 1.5 2 Inf</span></pre></body></html></div>
<p>We now can use this list of settings to run simulations for each. The following illustrates the use of multiple cores:</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">s</span>, <span class="no">bsims_all</span>)
<span class="no">nc</span> <span class="kw">&lt;-</span> <span class="fl">4</span> <span class="co"># number of cores to use</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">parallel</span>)
<span class="no">cl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span>(<span class="no">nc</span>)
<span class="no">bb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">b</span>, <span class="kw">function</span>(<span class="no">z</span>) <span class="no">z</span>$<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="no">B</span>, <span class="kw">cl</span><span class="kw">=</span><span class="no">cl</span>))
<span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span>(<span class="no">cl</span>)</pre></body></html></div>
<p>In some cases, we want to evaluate crossed effects of multiple settings. For example, road width and spatial pattern (random vs. clustered):</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">s</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bSims/man/expand_list.html">expand_list</a></span>(
  <span class="kw">road</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.5</span>),
  <span class="kw">xy_fun</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">NULL</span>,
    <span class="kw">function</span>(<span class="no">d</span>) <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">d</span>^<span class="fl">2</span>/<span class="fl">1</span>^<span class="fl">2</span>) + <span class="fl">0.5</span>*(<span class="fl">1</span>-<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">d</span>^<span class="fl">2</span>/<span class="fl">4</span>^<span class="fl">2</span>))),
  <span class="kw">density</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>)),
  <span class="kw">tint</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">tint</span>),
  <span class="kw">rint</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">rint</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">s</span>)
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ :List of 5</span>
<span class="co">#&gt;   ..$ road   : num 0</span>
<span class="co">#&gt;   ..$ xy_fun : NULL</span>
<span class="co">#&gt;   ..$ density: num [1:3] 1 1 0</span>
<span class="co">#&gt;   ..$ tint   : num [1:5] 2 4 6 8 10</span>
<span class="co">#&gt;   ..$ rint   : num [1:5] 0.5 1 1.5 2 Inf</span>
<span class="co">#&gt;  $ :List of 5</span>
<span class="co">#&gt;   ..$ road   : num 0.5</span>
<span class="co">#&gt;   ..$ xy_fun : NULL</span>
<span class="co">#&gt;   ..$ density: num [1:3] 1 1 0</span>
<span class="co">#&gt;   ..$ tint   : num [1:5] 2 4 6 8 10</span>
<span class="co">#&gt;   ..$ rint   : num [1:5] 0.5 1 1.5 2 Inf</span>
<span class="co">#&gt;  $ :List of 5</span>
<span class="co">#&gt;   ..$ road   : num 0</span>
<span class="co">#&gt;   ..$ xy_fun :function (d)  </span>
<span class="co">#&gt;   .. ..- attr(*, "srcref")= 'srcref' int [1:8] 5 5 5 53 5 53 5 5</span>
<span class="co">#&gt;   .. .. ..- attr(*, "srcfile")=Classes 'srcfilecopy', 'srcfile' &lt;environment: 0xd0beba8&gt; </span>
<span class="co">#&gt;   ..$ density: num [1:3] 1 1 0</span>
<span class="co">#&gt;   ..$ tint   : num [1:5] 2 4 6 8 10</span>
<span class="co">#&gt;   ..$ rint   : num [1:5] 0.5 1 1.5 2 Inf</span>
<span class="co">#&gt;  $ :List of 5</span>
<span class="co">#&gt;   ..$ road   : num 0.5</span>
<span class="co">#&gt;   ..$ xy_fun :function (d)  </span>
<span class="co">#&gt;   .. ..- attr(*, "srcref")= 'srcref' int [1:8] 5 5 5 53 5 53 5 5</span>
<span class="co">#&gt;   .. .. ..- attr(*, "srcfile")=Classes 'srcfilecopy', 'srcfile' &lt;environment: 0xd0beba8&gt; </span>
<span class="co">#&gt;   ..$ density: num [1:3] 1 1 0</span>
<span class="co">#&gt;   ..$ tint   : num [1:5] 2 4 6 8 10</span>
<span class="co">#&gt;   ..$ rint   : num [1:5] 0.5 1 1.5 2 Inf</span></pre></body></html></div>
</div>
<div id="limitations-and-extensions" class="section level2">
<h2 class="hasAnchor">
<a href="#limitations-and-extensions" class="anchor"></a>Limitations and extensions</h2>
<p>The package is not equipped with all the possible ways to estimate the model parameters. It only has rudimentary removal modeling and distance sampling functionality implemented for the interactive visualization and testing purposes. Estimating parameters for more complex situations ( i.e. finite mixture removal models, or via Hazard rate distance functions) or estimating abundance via multiple-visit N-mixture models etc. is outside of the scope of the package and it is the responsibility of the user to make sure those work as expected. Although there is an ever increasing set of scripts coversing some of these aspects in the <a href="https://github.com/psolymos/bSims/tree/master/inst/tmp"><code>/inst/tmp</code></a> folder of the package and in the <a href="https://peter.solymos.org/qpad-book/"><em>QPAD book</em></a>.</p>
<p>Other intentional limitation of the package is the lack of reverse interactions between the layers. For example the presence of an observer could influence behavior of the birds close to the observer. Such features can be implemented as methods extending the current functionality.</p>
<p>Another limitation is that this implementation considers single species. Observers rarely collect data on single species but rather count multiple species as part of the same survey. The commonness of the species, observer ability, etc. can influence the observation process when the whole community is considered. Such scenarios are also not considered at present. Although the same landscape can be reused for multiple species, and building up the simulation that way.</p>
<p>The package considers simulations as independent in space and time. When larger landscapes need to be simulated, there might be several options: (1) simulate a larger extent and put multiple independent observers into the landscape; or (2) simulate independent landscapes in isolation. The latter approach can also address spatial and temporal heterogeneity in density, behaviour, etc. E.g. if singing rate is changing as a function of time of day, one can define the <code>vocal_rate</code> values as a function of time, and simulate independent animation layers. When the density varies in space, one can simulate independent population layers.</p>
<p>These limitations can be addressed as additional methods and modules extending the capabilities of the package, or as added functionality to the core layer functions in future releases.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter Solymos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
